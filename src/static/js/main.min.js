var tabs,currentTab,currentMsgId,settingsPopup,addColumnPopup,focusedColumnInput,tipConf={delay:100},maxMessageCount=50,leftScrollSpeed=150,onScrolling=false,scrollingTimer=-1,reloadTimer=-1,reloadBackTimer=-1,msgCommandTimer=-1,updateTimestampTimer=-1,adItems=null,adIndex=0,stopAdTime=0,AD_SPACE_NUM=10,AD_STOPPING_SPAN=60*60*1000,REPLY_PREFIX="RE:",REPLY_PREFIX_LENGTH=REPLY_PREFIX.length,POST_KEY_MSG=postKey=="shift"?$I.R017:$I.R078,AMAZON_ASSOCIATES_ID="cm032-22",minColumnWidth=displayDensity=="compact"?240:300;function expandUrl(a,b){$.get(EXPAND_URL,{url:a},function(c){b(c)})}Array.prototype.shuffle=function(){var c=this.length;while(c){var a=Math.floor(Math.random()*c);var b=this[--c];this[c]=this[a];this[a]=b}return this};(function(a){a.fn.smallMenu=function(d){var e=function(i){var h=i.data("smallMenuOpts");h.target.hide();h.onclose(h.target)};var c=function(m){var i=m.data("smallMenuOpts");i.ondisplay(i.target);if(i.position){i.target.css(i.position).show();return}var j=m.offset();var h=parseInt(a(window).width());var l=j.top+m.height();var k=j.left;i.target.css({top:l,left:j.left,right:"auto"}).show();if(k+i.target.width()>h){i.target.css({top:l,right:0,left:"auto"}).show()}};if(d&&typeof d=="string"){if(d=="close"){a(this).each(function(){e(a(this))})}else{if(d=="open"){a(this).each(function(){c(a(this))})}else{if(d=="destroy"){a(this).each(function(){var i=a(this).unbind("click.smallMenu");var h=i.data("smallMenuOpts");if(h&&h.target){h.target.remove()}})}}}return this}var g={target:"",appended:false,position:false,ondisplay:function(){},onclose:function(){}};var f=a.extend(g,d);var b=a(document.body);if(!b.data("init.smallMenu")){b.bind("click.smallMenu",function(){a(".smallMenuLink").smallMenu("close")}).data("init.smallMenu",true)}return this.each(function(){var h=a(this).addClass("smallMenuLink").data("smallMenuOpts",f);var i=f.target;h.bind("click.smallMenu",function(j){if(!i||!i.data("init.smallMenu")){i=a(f.target).addClass("smallMenu").hide().data("init.smallMenu",true).bind("click.smallMenu",function(k){k.stopPropagation()});if(!f.appended){i.appendTo(document.body)}}if(i.css("display")=="none"){a(".smallMenuLink").smallMenu("close");c(h)}else{e(h)}j.stopPropagation()});return this})}})(jQuery);(function(a){a.fn.serviceList=function(b){return this.each(function(){var d=a(this).addClass("service-container");if(!d.data("init")){d.attr({cellpadding:0,cellspacing:0,width:"100%"});a("td:first",d).width(a(".service-list",d).width());var c=a('<td class="service-body"/>').appendTo(a("tr:first",d));a("a.button",d).blur().click(function(e){a("a.button",d).removeClass("selected");a(this).addClass("selected");c.empty().text("Loading...").load(this.href);e.preventDefault();e.stopPropagation();return false});a("a.button:first",d).click();d.data("init",true)}return this})}})(jQuery);(function(a){a.fn.autoid=function(b){return this.each(function(){if(!this.id){this.id="s_"+new Date().getTime()+"_"+Math.floor(Math.random()*1000)}return this})};a.fn.uploader=function(b){if(b&&typeof b=="string"){var c=a(this).first().data("uploader");if(b=="cancel"){if(c){c.cancel()}}else{if(b=="keys"){if(!c){return[]}return a.map(a(this).first().data("uploader").files,function(d){return d.key})}}return this}return this.each(function(){if(a(this).data("uploader")){return true}var e=a(this).addClass("uploader");var d=e.autoid().attr("id");var g=a('<a class="pickfiles" href="#"/>').text("[Select files]").autoid().appendTo(e);var i={runtimes:"html5,flash,gears,silverlight,browserplus,html4",browse_button:g.attr("id"),container:d,max_file_size:"10mb",url:"",flash_swf_url:STATIC_URL+"plupload/js/plupload.flash.swf",silverlight_xap_url:STATIC_URL+"plupload/js/plupload.silverlight.xap",filters:[{title:"Image files",extensions:"jpg,gif,png"}],required_features:"dragdrop",file_list_element:false};var h=a.extend(i,b);var f=h.file_list_element?a(h.file_list_element):a('<div class="filelist"/>').appendTo(e);var j=new plupload.Uploader(h);j.init();j.bind("FilesAdded",function(k,l){if(k.files.length>1){return}g.hide();f.show();a.each(l,function(n,m){f.append(a("<div/>").attr("id",m.id).append(a('<span class="file-name"/>').text(m.name+" ("+plupload.formatSize(m.size)+")"),a('<span class="progress"/>').text("0%"),a('<a class="delete-file" href="#"/>').text("[x]").click(function(o){k.cancel();o.stopPropagation()})));a.ajax({url:"/file/createurl",async:false,success:function(o){k.settings.url=o;k.start()}})});k.refresh();if(h.onFileAdded){h.onFileAdded(k,l)}});j.bind("UploadProgress",function(k,l){a("#"+l.id+" .progress").html(l.percent+"%")});j.bind("Error",function(k,l){f.show();f.append(a("<div/>").text("Error: "+l.code+", Message: "+l.message+(l.file?", File: "+l.file.name:"")));k.refresh()});j.bind("FileUploaded",function(k,l,m){l.key=m.response;a("#"+l.id+" .progress").html("100%").addClass("complete");if(h.onUploaded){h.onUploaded()}});j.cancel=function(){var k=[];a.each(j.files,function(){k.push(this.key);j.removeFile(this)});f.empty().hide();g.show();if(h.onCancel){h.onCancel()}if(k.length>0){a.post("file/delete",{key:k},a.noop)}j.refresh()};e.data("uploader",j);return e})}})(jQuery);function isPostKey(a){if(postKey=="control"&&a.ctrlKey&&a.keyCode==13){return true}if(postKey=="shift"&&a.shiftKey&&a.keyCode==13){return true}return false}function popup(a){window.open(a,"oauth","width=600, height=340, menubar=no, toolbar=no, location=no, scrollbars=yes")}function callOnlyInitial(a){if(!a.key){throw new Error("key is not set")}var d={key:"",count:1,callback:function(){},expires:100};var c=$.extend(d,a);var b=parseInt($.cookie(c.key))||0;if(b<c.count){c.callback();$.cookie(c.key,b+1,{expires:c.expires})}}THUMBNAIL_RESOLVER=[[/http:\/\/twitpic[.]com\/(\w+)/,'<img src="http://twitpic.com/show/thumb/$1" width="150" height="150" />'],[/http:\/\/www\.amazon\.co\.jp\/.*\/([0-9A-Z]{10,13})[\?\/]?.*/,'<img src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&Format=_SL110_&ASIN=$1&MarketPlace=JP&ID=AsinImage&WS=1&ServiceVersion=20070822" />'],[/http:\/\/amzn\.to\/.*/,function(a,b){expandUrl(a,function(c){getImageThumb(c,b)})}],[/http:\/\/(?:www[.]youtube[.]com\/watch(?:\?|#!)v=|youtu[.]be\/)([\w\-]+)(?:[-_.!~*\'()a-zA-Z0-9;\/?:@&=+$,%#]*)/,'<img src="http://i.ytimg.com/vi/$1/hqdefault.jpg" width="240" height="180" />'],[/http:\/\/yfrog[.]com\/(\w+)/,'<img src="http://yfrog.com/$1.th.jpg" />'],[/http:\/\/instagr[.]am\/p\/([\w\-]+)\//,'<img src="http://instagr.am/p/$1/media/?size=t" width="150" height="150" />'],[/http:\/\/moby[.]to\/(\w+)/,'<img src="http://moby.to/$1:small" width="150" />'],[/http:\/\/movapic[.]com\/pic\/(\w+)/,'<img src="http://image.movapic.com/pic/s_$1.jpeg" />'],[/http:\/\/f[.]hatena[.]ne[.]jp\/(([\w\-])[\w\-]+)\/((\d{8})\d+)/,'<img src="http://img.f.hatena.ne.jp/images/fotolife/$2/$1/$4/$3_120.jpg" />'],[/http:\/\/(?:www[.])?bcphotoshare[.]com\/photos\/\d+\/(\d+)/,'<img src="http://images.bcphotoshare.com/storages/$1/thumb180.jpg" width="180" height="180" />'],[/http:\/\/bctiny[.]com\/p(\w+)/,'\'<img src="http://images.bcphotoshare.com/storages/\' . base_convert("$1", 36, 10) . \'/thumb180.jpg" width="180" height="180" />\''],[/http:\/\/img[.]ly\/(\w+)/,'<img src="http://img.ly/show/thumb/$1" width="150" height="150" />'],[/http:\/\/brightkite[.]com\/objects\/((\w{2})(\w{2})\w+)/,'<img src="http://cdn.brightkite.com/$2/$3/$1-feed.jpg" />'],[/http:\/\/twitgoo[.]com\/(\w+)/,'<img src="http://twitgoo.com/$1/mini" />'],[/http:\/\/pic[.]im\/(\w+)/,'<img src="http://pic.im/website/thumbnail/$1" />'],[/http:\/\/imgur[.]com\/(\w+)[.]jpg/,'<img src="http://i.imgur.com/$1m.jpg" />'],[/(http:\/\/tweetphoto[.]com\/\d+|http:\/\/plixi[.]com\/p\/\d+|http:\/\/lockerz[.]com\/s\/\d+)/,'<img src="http://api.plixi.com/api/TPAPI.svc/imagefromurl?size=mobile&url=$1" height="180" />'],[/http:\/\/ow[.]ly\/i\/(\w+)/,'<img src="http://static.ow.ly/photos/thumb/$1.jpg" width="100" height="100" />']];function getImageThumb(a,c){var b="";$.each(THUMBNAIL_RESOLVER,function(){if(a.match(this[0])){if($.isFunction(this[1])){this[1](a,c)}else{b=this[1].replace("$1",RegExp.$1).replace("$2",RegExp.$2).replace("$3",RegExp.$3).replace("$4",RegExp.$4)}return false}});if(b){c({thumb:b,original:a})}}function showInformation(){if($("#information").data("init")){return}$("#information").dialog({modal:true,width:600}).data("init",true)}function toggleNoColumnMsg(){var a=currentTab.children(".column");$("#nocolumn").toggle(a.length==0);$("#tabs .tab-content").toggle(a.length!=0)}function renderMessages(h,d,e,c,j){var a,o,l=false;var b=h.getCreatedAt?h.getCreatedAt:function(p){return Date.parse(p.display_time)};if(j){if(j==true){a=e.children(".message:first");$(".new",e).removeClass("new")}else{if(j.hasClass&&j.hasClass("gap")){a=j.nextAll(".message:first");$(".new",e).removeClass("new");j.next().remove();j.remove();l=true}}}else{a=e.children(".message:last")}if(a.data("entry")){o=b(a.data("entry"))}var g=0,i=e.parents(".column-content"),k=i.prop("scrollHeight");preScrollTop=i.scrollTop();var n=[];$.each(d.messages||[],function(){var q=h.getEntry?h.getEntry(this):this;messageElm=h.renderMessage(q,c,j,d);if(!messageElm){return true}if(j&&a.length>0){if(!o||b(q)>o){if(h.onBeforeInsertMessage){h.onBeforeInsertMessage(q,c,messageElm);if(a.parent().length==0){a=e.children(".message:first")}}messageElm.addClass("new").insertBefore(a);g++;if(!l&&notificationStatus&&c.prefs.notification){var p=h.getNotificationInfo(q,d,c,o);if($.isArray(p)){n=p.concat(n)}else{n.unshift(p)}}}else{return h.checkAllMessages?true:false}}else{if(!o||b(q)<o){messageElm.appendTo(e)}}});var m=null;e.children(".message").each(function(p,r){var q=$(this);q.toggleClass("odd",!m||!m.hasClass("odd"));m=q});if(j){if(h.getGapMessages&&g>0&&d.messages.length==g){a.before($('<div class="gap">').text($I.R001).click(h.getGapMessages),$('<div class="gap-loading"><span>'+$I.R002+"</span></div>").hide())}$.each(n,function(){showNotification(this.title,this.message,this.icon)});e.parent().prevAll(".new-count").text(g>30?"30+":g).toggle(g>0);var f=i.prop("scrollHeight")-k;if(f!=0&&preScrollTop>0){i.scrollTop(i.scrollTop()+f)}showNotificationCount(c,g)}if(h.onAfterRenderMessages){h.onAfterRenderMessages(d,e,c)}}function loadColumn(g,f,c){var h=g.data("init");g.data("init",true);$(".column-header .icon",g).addClass("loading");var e=g.data("conf"),d=e.service+"/messages/"+e.account_name,b=g.find(".message-list");$(".error",b).remove();var a=window[e.service];$.ajax({url:d,data:{type:e.type},success:function(j){if(!f||$(".message",b).length==0){b.empty()}renderMessages(a,j,b,e,f);renderAccountImage(a,g,e);if(a.moreMessages){g.find(".more-message").show()}if(c){b.parent().animate({scrollTop:0})}if(g.parents(".tab").attr("id")==currentTab.attr("id")&&g.prevAll(".column").length==0&&stopAdTime<(new Date().getTime()-AD_STOPPING_SPAN)){function i(){if(!adItems){adItems=[]}if(adItems.length==0){return}var m=Math.floor(Math.random()*AD_SPACE_NUM+1);var k=0;if(m<adItems.length){adIndex=!adIndex||adIndex>adItems.length-1?0:adIndex;k=adItems[adIndex++]}else{k={type:"default"}}$("#adMessage").remove();adMessage=$('<div id="adMessage"/>').hide();if(k.type&&k.type=="default"){adMessage.addClass("banner");adMessage.append($('<a class="adCloseIcon" href="#"/>'),$('<div class="adContents"/>').hover(function(){$(this).animate({height:200})},function(){$(this).animate({height:100})}).append($(AD_HTML)));$('<iframe src="'+STATIC_URL+"ad/impression.html?url="+encodeURIComponent("geniee.co.jp")+'"/>').hide().appendTo(adMessage)}else{if(k.type&&k.type=="banner_only"){var l="/ad?url="+encodeURIComponent(k.url);adMessage.addClass("banner");adMessage.append($('<a class="adCloseIcon" href="#"/>'),$('<div class="adContents"/>').hover(function(){$(this).animate({height:k.height})},function(){$(this).animate({height:100})}).append($('<a target="_blank"/>').attr("href",l).append($("<img/>").attr("src",k.banner_url))));$('<iframe src="'+STATIC_URL+"ad/impression.html?url="+encodeURIComponent(k.url)+'"/>').hide().appendTo(adMessage)}else{var l="/ad?url="+encodeURIComponent(k.url);adMessage.append($('<div class="adContents"/>').append($('<a class="adCloseIcon" href="#"/>'),$('<p class="adHead"/>').append($('<a target="_blank"/>').attr("href",l).text(k.title)),$('<table class="adTable"/>').append($("<tbody/>").append($("<tr/>").append($('<td class="adThumb"/>').append($('<a target="_blank"/>').attr("href",l).append($('<img width="100" height="74"/>').attr("src",k.banner_url))),$('<td class="adBody"/>').text(k.body))))));$('<iframe src="'+STATIC_URL+"ad/impression.html?url="+encodeURIComponent(k.url)+'"/>').hide().appendTo(adMessage)}}adMessage.prependTo(b).fadeIn().find(".adCloseIcon").click(function(){$("#adMessage").fadeOut();stopAdTime=new Date().getTime()})}if(adItems){i()}else{$.getJSON("/static/ad/ad.json",function(k){adItems=k.shuffle();i()})}}},error:function(j){if(!f||$(".message",b).length==0){b.empty()}if(j.status==401||j.status==403){$('<div class="error reauth"/>').text($I.R003).prependTo(b).click(function(){if(e.service=="yammer"){popup("/yammer/authorize")}else{if(e.service=="facebook"){popup("/facebook/oauth")}else{window.open("/oauth/"+e.service+"/request")}}})}else{var i=$I.R004;if(a.name){i=$I.R076({service:a.name})}$('<div class="error"/>').text(i).prependTo(b).click(function(){loadColumn(g,true)})}},complete:function(){$(".column-header .icon",g).removeClass("loading");g.parents(".tab").dequeue();tabs.dequeue()}});if(a.moreMessages&&!h){g.find(".more-message").click(a.moreMessages);g.find(".column-content").scrollTop(0).scroll(function(){var j=$(this),i=j.data("moreTimer");if(i){clearTimeout(i)}if(j.scrollTop()==j.prop("scrollHeight")-j.height()){var i=setTimeout(function(){g.find(".more-message").click()},1000);j.data("moreTimer",i)}})}}function loadTabContent(){if(!currentTab){return}currentTab.data("init",true).find(".column").each(function(a,b){var c=$(b);if(!c.data("init")){loadColumn(c)}})}var growingDummy=$('<div class="growing-dummy"/>'),minHeight=32,closedHeight=20;function openColumnInput(j,f,c,b,a,l){var d=$("#"+f.key);j=j||d;var k=j.children(".column-input").show(),i=k.find(".message-input textarea"),g=window[f.service];focusedColumnInput=k;if(g.canUploadImage){$(".uploader",k).uploader({required_features:"",file_list_element:k.find(".filelist"),onFileAdded:function(e,m){k.find(".fileadded").show()},onUploaded:function(){countMessage(window[f.service],k.find(".message-input textarea"))},onCancel:function(){k.find(".fileadded").hide();countMessage(window[f.service],k.find(".message-input textarea"))}})}if(!!c){i.val(c)}i.focus();try{if(l){i.get()[0].setSelectionRange(0,0)}else{i.get()[0].setSelectionRange(c.length,c.length)}}catch(h){}if(b){i.siblings("input[name=reply-to]").val(b);if(a){$(".reply-to-message",j).text(REPLY_PREFIX+a).show()}}else{if(k.data("reply-to")){i.siblings("input[name=reply-to]").val(k.data("reply-to"))}if(k.data("reply-to-message")){$(".reply-to-message",j).text(REPLY_PREFIX+k.data("reply-to-message")).show()}}$("#message-command").hide();adjustColumnContentHeight(d);countMessage(g,i)}function countMessage(a,d){d=d||$(this);var c=d.siblings(".counter"),b=0,e=d.parents(".column-input").find(".uploader");if(a.countMessage){b=a.countMessage(d.val().replace(/\s+$/g,""),e)}else{b=a.messageLimit-d.val().replace(/\s+$/g,"").length}c.text(b).toggleClass("over",b<0)}function createColumnInput(g,d,h,i,a){var b=h.key,a=a||{},f=i?i.parent():false;function j(m){var n=g.getPostUrl(h),p=m.val().replace(/\s+$/g,""),q=m.parent(),l=q.find("input[name=reply-to]"),r=q.parent().find(".uploader");if(!p){return}if(g.countMessage){var o=g.countMessage(p,r);if(o<0){p=p.substring(0,p.length+o)}}else{if(g.messageLimit>0){p=p.substring(0,g.messageLimit)}}m.attr("disabled",true);q.addClass("loading");$.ajax({type:"POST",url:n,data:{message:p,"reply-to":l.val(),"file-key[]":r.uploader("keys")},success:function(s){showNotice($I.R015);m.val("").height(minHeight);l.val("");$(".reply-to-message",d).text("").hide();if(g.openColumnInput){g.openColumnInput(d,h)}r.uploader("cancel");countMessage(g,m);setTimeout(function(){if(d.data("reload")){d.data("reload")(s)}else{loadColumn($("#"+b),true)}},2000)},error:function(){showError($I.R016)},complete:function(){q.removeClass("loading");m.removeAttr("disabled").focus()}})}function e(l){try{if(isPostKey(l)){j($(this));return false}}catch(l){console.error(l)}}function c(l){if(k.hasClass("focus")){return}closeColumnInput(focusedColumnInput,l);if(g.openColumnInput){g.openColumnInput(d,h);countMessage(g,$("textarea",k))}else{openColumnInput(f,h,false,"")}focusedColumnInput=k}var k=$('<div class="column-input"/>').append($('<div class="reply-to-message"/>')).append($('<div class="message-input"/>').append($('<div class="account-image-outer"/>').append($('<img class="account-image"/>').attr("src",STATIC_URL+"images/noprofileimage.gif"),$('<a class="profile-select" href="#"/>').text("▼"))).append($("<textarea />").keydown(e).focus(function(){var l=$(this);k.addClass("focus");var m=$(".reply-to-message",k);if(m.text()){m.show()}l.data("growing")(null,true)}).growing({minHeight:minHeight,maxHeight:160,lineHeight:16,buffer:0,dummy:growingDummy})).append($('<input type="hidden" name="reply-to"/>')).append($('<div class="help"/>').text(POST_KEY_MSG).attr("title",POST_KEY_MSG))).append($('<div class="input-footer"/>').append($('<div class="filelist"/>')).append($('<div class="tool-bar"/>').append(a.noAttach?"":$('<div class="uploader"/>').append($('<div class="fileadded"/>'))).append($('<div class="help2"/>').text(POST_KEY_MSG)).append($('<div class="submit-btn"/>').append($('<a href="#"/>').text($I.R019).click(function(){j($("textarea",k))}))).append($('<div class="clear-btn"/>').append($('<a href="#"/>').text($I.R020).click(function(){$("textarea",k).val("").height(minHeight).focus();$("input[name=reply-to]",k).val("");$(".reply-to-message",k).text("").hide();$(".uploader",k).uploader("cancel")}))))).click(c).insertAfter(i||$(".column-header",d));if(a.hideFirst){k.hide()}if(a.replyTo){k.data("reply-to",a.replyTo)}if(a.replyToMsg){k.data("reply-to-message",a.replyToMsg)}if(g.messageLimit>0){$('<div class="counter"/>').text(g.messageLimit).appendTo($(".message-input",k));$("textarea",k).keyup(function(l){countMessage(g,$(this))})}}function closeColumnInput(c,d){if(!c||c.length==0){return}var a=$("textarea",c);var b=$(".reply-to-message",c).hide();c.removeClass("focus");a.height(closedHeight);adjustColumnContentHeight(a.closest(".column"));$("#message-command").hide();focusedColumnInput=null}function createColumn(c,a,i,b){var g=window[i.service];var d=$('<span class="column-name"/>');var k=g.getColumnLink&&g.getColumnLink(i);if(k){$('<a target="_blank"/>').attr("href",g.getColumnLink(i)).text(a).appendTo(d)}else{d.text(a)}var e=$('<div class="column"/>').attr("id",c).addClass(i.prefs.bg_color||"").append($('<div class="new-count"/>')).append($('<div class="column-header">').append($('<div class="icon"/>').addClass(g.getIconClass(i))).append($('<img class="account-image"/>').attr("src",STATIC_URL+"images/noprofileimage.gif")).append(d).append($('<div class="account-label"/>').text(i.account_label)).append($('<div class="column-header-icon"/>').append($('<a class="reloadButton"/>')).append($('<a class="menuButton"/>')))).append($('<div class="column-content"/>').append($('<div class="message-list"><p>Loading...</p></div>')).append($('<div class="more-message" style="display:none">'+$I.R005+"</div>")).append($('<div class="loading-message" style="display:none"><span>'+$I.R006+"</span></div>"))).addClass(i.service).data("conf",i).appendTo(b);if(g.afterBuildColumn&&typeof(g.afterBuildColumn)=="function"){g.afterBuildColumn(e)}var f=null;function j(){f.hide();if(!window.webkitNotifications){alert($I.R007);return}var m=f.data("column");var l=m.data("conf");var n=m.attr("id");newnotification=!l.prefs.notification;$(this).find(".column-notification-status").text(newnotification?"ON":"OFF");if(!notificationStatus){if(confirm($I.R008)){toggleNotification()}}$.ajax({type:"POST",url:"column/updateprefs",data:{id:n,notification:newnotification?"true":""},success:function(o){showNotice($I.R009({name:l.name}));l.prefs.notification=newnotification},error:function(){showError($I.R010({name:l.name}))}})}function h(){var m=f.data("column");var l=m.data("conf");f.hide();if(!confirm($I.R011({name:l.name}))){return}var n=m.attr("id");$.post("column/delete",{id:n},function(){m.remove();$("#s-"+n).remove();toggleNoColumnMsg();calculateColumnSize();adjustTabs()})}f=$('<div id="column-opt"/>').append($('<div class="menu-item"/>').append($('<a href="javascript:void(0)"/>').html($I.R012({status:'<span class="column-notification-status">'+(i.prefs.notification?"ON":"OFF")+"</span>"})).click(j))).append($('<div class="menu-item"/>').append($('<span class="label"/>').text($I.R086))).append($('<div class="menu-item"/>').html('<table class="color-table" cellspacing="0" cellpadding="0"><tbody><tr/></tbody></table>')).append($('<div class="menu-item"/>').append($('<a href="javascript:void(0)"/>').text($I.R014).click(h)));$("tr",f).append($('<td><div class="bg-default">a</div></td>'),$('<td><div class="bg-red">a</div></td>'),$('<td><div class="bg-orange">a</div></td>'),$('<td><div class="bg-yellow">a</div></td>'),$('<td><div class="bg-green">a</div></td>'),$('<td><div class="bg-blue">a</div></td>'),$('<td><div class="bg-purple">a</div></td>'));$(".color-table td div",f).click(function(n){f.hide();var o=$(this),m=f.data("column"),l=m.data("conf"),q=o.attr("class");var p=m.attr("class").split(" ");p=$.grep(p,function(r){return r.indexOf("bg-")!=0});p.push(q);m.attr("class",p.join(" "));$.ajax({type:"POST",url:"column/updateprefs",data:{id:m.attr("id"),bg_color:q},success:function(r){showNotice($I.R087({name:l.name}))},error:function(){showError($I.R088({name:l.name}))}});n.stopPropagation()});$(".column-header .menuButton",e).smallMenu({target:f,ondisplay:function(){f.data("column",e)}});if(g.canPostInColumn&&g.canPostInColumn(e,i)){createColumnInput(g,e,i)}if(accountsMap){renderAccountImage(g,e,i)}$("<div/>").attr("id","s-"+i.key).addClass("icon").addClass(g.getIconClass(i)).attr("title",i.name+(i.account_label?(" / "+i.account_label):"")).tipTip(tipConf).click(function(){var l=$(this).removeClass("new").parents(".shortcuts").attr("id").substring(2);if(l!=currentTab.attr("id")){$("#tabs-navi li:has(.tab-name[href=#"+l+"])").click()}scrollToColumn(i.key);return false}).appendTo($("#s-"+b.attr("id")));$(".column-header",e).mousewheel(function(n,o){var m=$("#tabs .tab-content");var l=m.scrollLeft()-o*leftScrollSpeed;m.scrollLeft(l)});return e}function adjustColumnContentHeight(a){var b=a.children(".column-content"),c=a.height();b.each(function(){var d=$(this);d.css("height",c-d.position().top)})}function scrollToColumn(c){var b=$("#tabs .tab-content");var a=b.scrollLeft()+$("#"+c).offset().left-1;b.animate({scrollLeft:a},500)}function calculateColumnSize(){if(!currentTab){return}var c=currentTab.children(".column");var a=c.length>8?8:c.length;if(a==1){a=2}var b=$("#tabs .tab-content").width();var e=Math.floor(b/a-3);while(e<minColumnWidth){if(a==1){e=minColumnWidth;break}e=Math.floor(b/--a-3)}var d=$("#tabs").height()-$("#tabs-navi").height()-$("#tab-tool-bar").height()-8;if(c.length>a){d-=$.browser.webkit?10:15}var f=d-4;currentTab.css("width",c.length>0?(e+3)*c.length:"100%");c.css("width",e);if($.browser.msie){c.children(".column-content").css("height",100)}c.css("height",f);adjustColumnContentHeight(c)}function addColumn(b,c){if(!b){return}var a=$(".column",currentTab);b.tabId=currentTab.attr("id");b.order=a.length>0?a.last().data("conf").order+1:0;$.post("column/add",b,function(d){try{var f=createColumn(d.key,d.name,d,currentTab);toggleNoColumnMsg();calculateColumnSize();if(c){c()}loadColumn(f);scrollToColumn(d.key);adjustTabs()}catch(g){console.error(g)}})}function addDefaultColumn(d,b,a,c){function e(){var g=window[d];var f=g.getDefaultColumnInfo(b,a);$.each(f,function(){this.service=d;addColumn(this)})}if(c){e();return}$('<div class="confirm"/>').text($I.R022).dialog({height:140,resizable:false,modal:true,buttons:[{text:$I.R026,click:function(){$(this).dialog("close")}},{text:$I.R075,click:function(){e();$(this).dialog("close")}}]})}function adjustTabs(l){function c(){var m=4;$("#tabs-navi li").each(function(){m+=$(this).width()+8});return m}var a=c(),b=$("#tabs-background").width();var e=b-100-($("#right-header").width()+20)-30;if(a<=e){tabs.removeClass("scroll");$("#tabs-navi-cover-right").width(b-a-100);$("#tabs-navi").css("left",100)}else{var g=130;e-=60;var k=$("#tabs-navi");if(!tabs.hasClass("scroll")){$("#tabs-navi-cover-right").width(b-e-g);k.css("left",k.offset().left+30);tabs.addClass("scroll")}var i=(e+g)-a;if(l||k.offset().left<i){k.css("left",i)}if(!k.data("initScrollHandler")){k.data("initScrollHandler",true);var f=-1,d=100;function h(){var n=k.offset().left;if(n==g){return}var m=n+100;k.animate({left:m>g?g:m},d);f=setTimeout(h,d)}function j(){var o=0,r=k.offset().left;var q=c(),n=$("#tabs-background").width(),m=n-g-$("#tabs-navi-cover-right").width(),p=(m+g)-q;if(r<p){return}else{if(r-100<p){o=p}else{o=r-100}}k.animate({left:o},d);f=setTimeout(j,d)}$("#tabs-prev").mousedown(h);$("#tabs-next").mousedown(j);$("#tabs-prev, #tabs-next").mouseup(function(){clearInterval(f)})}}}function renderTabs(){$.each(tabConfs,function(e,f){$("<li/>").append($('<a class="tab-name"/>').attr("href","#"+f.key).text(f.name),$('<input type="text" style="display:none;"/>').val(f.name),$('<span class="ui-icon ui-icon-close"/>').attr("title",$I.R023),$('<div class="shortcuts"/>').attr("id","s-"+f.key)).data("conf",f).appendTo("#tabs-navi");var d=$('<div id="'+f.key+'" class="tab"></div>').appendTo($("#tabs .tab-content"));$.each(f.columns,function(){createColumn(this.key,this.name,this,d)});if(!currentTab){currentTab=d}});toggleNoColumnMsg();$(document.body).click(function(e){if($(e.target).closest(".column-input.focus").length>0){return}var d=$(".column-input.focus");closeColumnInput(d,e)});tabs=$("#tabs").tabs({tabTemplate:'<li><a href="#{href}" class="tab-name">#{label}</a><input type="text" style="display:none;" value="#{label}"/><span class="ui-icon ui-icon-close" title="'+$I.R023+'"></span></li>',panelTemplate:'<div class="tab"></div>',select:function(d,e){var f=$(e.panel).find(".column:first .message-list");if(f.length>0){$("#adMessage").detach().prependTo(f)}}});$("#tabs-navi").sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:true,delay:100,helper:"clone",update:function(d,e){var f=[];$("#tabs-navi li a").each(function(){f.push(this.getAttribute("href").substring(1))});$.post("tab/sort",{tabs:f.join(",")},function(g){})}});var c={placeholder:"ui-state-highlight",forcePlaceholderSize:true,handle:".column-header",update:function(f,g){var e=$(g.item[0]);if(e.prev().length>0){$("#s-"+e.attr("id")).detach().insertAfter($("#s-"+e.prev().attr("id")))}else{if(e.next().length>0){$("#s-"+e.attr("id")).detach().insertBefore($("#s-"+e.next().attr("id")))}}var d=[];$(".column",currentTab).each(function(){d.push(this.id)});adjustTabs();$.post("column/sort",{columns:d.join(",")},function(h){})}};var a={placeholder:"ui-state-highlight",connectWith:"#tabs-navi .shortcuts",delay:100,update:function(h,i){var j=$(h.target);var f=$(i.item[0]);if(j.find(".icon").index(f)<0){return}var e=$(j.closest("li").find("a.tab-name").attr("href"));var g=$("#"+f.attr("id").substring(2)).detach();if(f.prev().length>0){g.insertAfter($("#"+f.prev().attr("id").substring(2)))}else{if(f.next().length>0){g.insertBefore($("#"+f.next().attr("id").substring(2)))}else{g.appendTo(e)}}calculateColumnSize();var d=[];$(".column",e).each(function(){d.push(this.id)});toggleNoColumnMsg();adjustTabs();$.post("column/sort",{tabId:e.attr("id"),columns:d.join(",")},function(k){})}};$("#add-tab").click(function(){var f="untitled",g=$("#tabs-navi li"),d=g.length>0?g.last().data("conf").order+1:0;var e={name:f,order:d};$.post("tab/add",e,function(h){tabs.tabs("add","#"+h,f);$("#tabs-navi li:last").data("conf",e).append($('<div class="shortcuts"/>').attr("id","s-"+h).sortable(a));tabs.tabs("select","#"+h);currentTab=$("#"+h).detach().appendTo($("#tabs .tab-content"));toggleNoColumnMsg();currentTab.sortable(c);adjustTabs(true)})});$("#tabs-navi span.ui-icon-close").livequery("click",function(){if($("#tabs-navi li").length==1){alert($I.R024);return}if(!confirm($I.R025)){return}var e=$(this).prevAll("a.tab-name").attr("href").substring(1);var d=$("li",tabs).index($(this).parent());$.post("tab/delete",{id:e},function(){var f=$("#"+e).prev().attr("id");if(!f){f=$("#"+e).next().attr("id")}tabs.tabs("remove",d);$("#s-"+e).remove();$("#s-"+f).parent("li").click();currentTab=$("#"+f);toggleNoColumnMsg();if(!currentTab.data("init")){loadTabContent()}calculateColumnSize();adjustTabs()})});$("#tabs-navi li").livequery("click",function(){var d=$(".tab-name",this);var e=d.attr("href").substring(1);$("#s-"+currentTab.attr("id")).prevAll("input").hide().prev().show();if(currentTab.attr("id")!=e){tabs.tabs("select","#"+e);currentTab=$("#"+e);toggleNoColumnMsg();if(!currentTab.data("init")){loadTabContent()}calculateColumnSize();return}});$("#tabs-navi .tab-name").livequery("click",function(){var d=$(this);var e=d.attr("href").substring(1);if(currentTab.attr("id")==e){d.next().show().focus().width(d.width()+15);d.hide()}else{d.parent().click()}});$("#tabs-navi .tab-name + input").livequery("click",function(){return false});$("#tabs-navi .tab-name + input").livequery("blur keydown",function(e){if(e.type=="keydown"&&e.keyCode!=13){return}var d=$(this).val();var f=$(this).prev();$(this).hide();if(d==f.text()){f.show();return}f.text(d).show();adjustTabs();$.post("tab/rename",{id:f.attr("href").substring(1),name:d})});$("#nocolumn button").button();$("#add-column, #nocolumn button").click(function(){addColumnPopup=$("#add-column-popup").dialog({modal:true,width:600,height:420,open:function(){$("#add-column-tabs").serviceList()},buttons:[{text:$I.R018,click:function(){$(this).dialog("close")}},{text:$I.R027,click:function(){var e=getColumnInfo(),d=$(this);addColumn(e,function(){var f=window[e.service];if(f&&f.getPostUrl){var g=f.getPostUrl(e);if(g&&!accountsMap[g]){loadAccounts()}}})}}]})});$("#tabs .column-header .reloadButton").livequery("click",function(){var d=$(this).parents(".column");loadColumn(d,true,true)});$(".column .new-count").livequery("click",function(){var e=$(this),d=e.parents(".column");$(".message.new",d).removeClass("new");e.hide().text(0);$("#s-"+d.attr("id")).removeClass("new")});function b(){var d=$(window).height()-$("#footer").height()-5;$("#tabs").css("height",d);if($.browser.msie){$("#tabs .tab-content").css("width",$(window).width());$("#tabs .tab-content").css("height",d-$("#tabs-navi").height()-$("#tab-tool-bar").height())}adjustTabs()}$(window).bind("resize",b);b();$(window).bind("resize",calculateColumnSize);calculateColumnSize();loadTabContent();$("#tabs .tab-content .tab").sortable(c);$("#tabs-navi .shortcuts").sortable(a);$("#tabs .tab-content").mousewheel(function(){onScrolling=true;if(scrollingTimer>0){clearTimeout(scrollingTimer)}scrollingTimer=setTimeout(function(){onScrolling=false;scrollingTimer=-1},100)})}function showSettings(){$("#settings-popup").toggleClass("firststep",accounts.length==0);settingsPopup=$("#settings-popup").dialog({modal:true,width:700,height:420,open:function(){$("#user-menu").smallMenu("close");$("#settings-tabs").tabs();$("#account-tabs").serviceList()},buttons:[{text:$I.R018,click:function(){$(this).dialog("close")}}]})}function renderAccountImage(c,a,g){if(!accountsMap||!c.getPostUrl){return}try{g.currentAccount=null;var b=accountsMap[c.getPostUrl(g)],h,i;if(c.getOtherAccount){otherAccounts=c.getOtherAccount(g);if(otherAccounts.length>0){if(b){otherAccounts.unshift(b)}else{b=otherAccounts[0]}if(otherAccounts.length>1){var f=$('<div class="select-account"/>');$.each(otherAccounts,function(e,k){f.append($('<a class="account" href="#"/>').append($("<img/>").attr("src",k.profile_image_url)).append($("<span/>").text(k.name)).click(function(){$(".column-input .account-image",a).attr("src",k.profile_image_url);g.currentAccount=k;$(".column-input .account-image-outer",a).smallMenu("close")}))});a.children(".column-input").addClass("multi").find(".account-image-outer").smallMenu("destroy").smallMenu({target:f})}}}g.currentAccount=b;if(b){h=b.group_image_url;i=b.profile_image_url}if(c.getGroupImageUrl){var j=c.getGroupImageUrl(g);if(j){h=j}}if(h||i){$(".column-header .account-image",a).attr("src",h||i).error(function(){$(this).unbind("error");if(c.onErrorGroupImage){c.onErrorGroupImage(this,g,i,h)}else{this.src=STATIC_URL+"images/noprofileimage.gif"}return true});$(".column-input .account-image",a).attr("src",i||h).error(function(){$(this).unbind("error");if(c.onErrorProfileImage){c.onErrorProfileImage(this,g,i,h)}else{this.src=STATIC_URL+"images/noprofileimage.gif"}return true})}}catch(d){console.error(d)}}var minMessageLimit=140;var accounts,accountsMap;function loadAccounts(a){$.getJSON("account/",function(d){accounts=[],accountsMap={};$.each(d,function(f,g){$.each(g,function(){this.service=f;this.value=f+"/"+this.name;accountsMap[this.url]=this});$.merge(accounts,g)});if(a){a()}else{$("#message-from").autocomplete("option","source",accounts)}$(".column").each(function(){var h=$(this),g=h.data("conf"),f=window[g.service];renderAccountImage(f,h,g)});var b=$("#account-info .account-thumb");if(!b.data("loaded")){var e="",c="";$.each(accounts,function(){if(this.service=="facebook"&&this.type=="user"&&this.profile_image_url){c=this.profile_image_url}if(this.profile_image_url&&!e){e=this.profile_image_url}if(c){return false}});if(e){b.data("loaded",true).error(function(){this.src=STATIC_URL+"images/noprofileimage.gif"}).attr("src",c||e)}}})}function addMessageFrom(c){var b=accountsMap[c];var a=window[b.service].getIconClass({service:b.service,postUrl:c});$('<div class="message-from-added ui-state-default"/>').append($('<div class="icon"/>').addClass(a),$("<span/>").text(b.name),$('<div class="ui-icon ui-icon-close"/>').click(function(){removeMessageFrom($(this).parent());return false})).data("item",b).insertBefore($("#message-from"));$("#message-from").val("");onAfterUpdateMessageFrom()}function removeMessageFrom(a){a.remove();$("#message-from").css("visibility","visible").focus();onAfterUpdateMessageFrom()}function onAfterUpdateMessageFrom(){var a=$("#message-post-dialog .message-from-added");minMessageLimit=-1;var b=[];countInputMessage();$.each(a,function(){var d=$(this).data("item"),c=window[d.service];if(!c.canUploadImage){b.push(c.name||d.service)}});if(b.length>0){$("#upload-image-warning").text($I.R079({services:b.join("/")})).show()}else{$("#upload-image-warning").text("").hide()}}function countInputMessage(){var b=$("#message-counter"),d=$("#message-body").val();var a=d.replace(/\s+$/g,"").length;b.text(a).show();$("#message-body-footer .icon").hide();var c=$("#message-post-dialog .message-from-added");$.each(c,function(){var g=$(this).data("item"),e=window[g.service];if(e.countMessage){var f=e.countMessage(d,$("#filecontainer"));if(f<0){$("#message-over-"+g.service).show()}}else{if(a>e.messageLimit){$("#message-over-"+g.service).show()}}})}function clearMessageFrom(){$("#message-from").val("").autocomplete("close").siblings(".message-from-added").remove()}function clearInputMessage(){clearMessageFrom();$("#message-body").val("");$("#message-url").val("");countInputMessage();$("#reply-to").val("");$("#reply-to-message").text("").hide();$("#address-shortcut-check:checked").removeAttr("checked");$("#upload-image-warning").text("").hide();$("#filecontainer").uploader("cancel")}function initMessagePost(){function a(){var d=$("#message-post-dialog .message-from-added"),h=$("#message-body").val().replace(/\s+$/g,"");if(d.length==0||!h){return}$("#message-post-loading").show();try{var g=[],c=[],j=false;$.each(d,function(){c.push($(this).data("item").url)});$.each(d,function(){var m=$(this).data("item"),k=m.url,e=window[m.service];if(e.countMessage){var l=e.countMessage(h,$("#filecontainer"));if(l<0){h=h.substring(0,h.length+l)}}else{if(e.messageLimit>0){h=h.substring(0,e.messageLimit)}}g.push(m);$.ajax({type:"POST",url:k,data:{message:h,"reply-to":$("#reply-to").val(),"file-key":$("#filecontainer").uploader("keys")},success:function(){showNotice($I.R028({name:m.name}))},error:function(){showError($I.R029({name:m.name}));j=true},complete:function(){for(var n=0;n<c.length;n++){if(c[n]==k){c.splice(n,1);break}}if(c.length==0){$("#message-post-loading").hide();if(!j){$("#message-body").val("");$("#reply-to").val("");$("#reply-to-message").text("").hide();$("#address-shortcut-check:checked").removeAttr("checked");$("#filecontainer").uploader("cancel")}}}})})}catch(i){console.error(i);$("#message-post-loading").hide()}if($("#address-shortcut-check:checked").val()){var f=prompt($I.R030)||"NO TITLE";$.ajax({type:"POST",url:"shortcut/add",data:{name:f,address_info:JSON.stringify(g)},success:function(){showNotice($I.R031({name:f}));renderAddressShortcuts()},error:function(){showError($I.R032({name:f}))}})}}function b(c){try{if(isPostKey(c)){a();return false}}catch(c){}}$("#message-help").text(POST_KEY_MSG);loadAccounts(function(){if(accounts.length==0){showSettings()}else{if(information_key){callOnlyInitial({key:information_key,callback:function(){showInformation()}})}}var c=null,d=false;$.each(accounts,function(){if(this.service!="facebook"){d=true}else{if(this.type=="user"){c=this}}});if(c){if(!d&&loginService=="facebook"&&$(".column").length==0){addDefaultColumn("facebook",c.account_name,c.name,true)}}$("#message-from").autocomplete({minLength:0,delay:100,source:accounts,select:function(e,f){addMessageFrom(f.item.url);return false},focus:function(e,f){return false},open:function(e,f){$(this).data("open",true)},close:function(e,f){$(this).data("open",false)}}).keydown(function(f){var g=$(this),e=g.prev(".message-from-added");if(f.keyCode==8&&g.val().length==0){if(e.length==0){return false}if(e.hasClass("ui-state-active")){removeMessageFrom(e)}else{e.addClass("ui-state-active");g.css("visibility","hidden")}setTimeout(function(){$("#message-from").autocomplete("close")},200);return false}else{if(e.hasClass("ui-state-active")){g.css("visibility","visible");e.removeClass("ui-state-active")}}}).blur(function(){$(this).prev(".message-from-added.ui-state-active").removeClass("ui-state-active")}).data("autocomplete")._renderItem=function(e,f){return $("<li/>").data("item.autocomplete",f).append($("<a/>").addClass(window[f.service].getIconClass({service:f.service,postUrl:f.url})).text(f.name)).appendTo(e)};$("#message-from").parent().click(function(){var e=$("#message-from");e.focus().css("visibility","visible");if(e.data("open")){e.autocomplete("close")}else{e.autocomplete("search","")}});$("#message-post-dialog button").button();$("#message-post-ok").click(function(){a()});$("#message-post-clear").click(function(){clearInputMessage()});$("#filecontainer").uploader({drop_element:"message-post-dialog",file_list_element:$("#message-post-dialog .filelist")});$("#message-body").keydown(b).keyup(countInputMessage);$("#multiPost").click(function(){showPostMessageDialog()})})}function showPostMessageDialog(c,d,a,b){if(d){clearInputMessage();if($.isArray(d)){$.each(d,function(){addMessageFrom(this)})}else{addMessageFrom(d)}}if(c){$("#message-body").val(c);countInputMessage()}if(a&&b){$("#reply-to").val(a);$("#reply-to-message").text(REPLY_PREFIX+b).show()}$("#message-post-dialog").dialog({modal:false,width:500,position:[0,0],open:function(){if($("#message-post-dialog .message-from-added").length>0){$("#message-body").focus()}},close:function(){$("#message-from").autocomplete("close");$(document.body).focus()}})}var colorTable='<table class="color-table" cellspacing="0" cellpadding="0"><tbody><tr><td><div style="background-color: rgb(222, 229, 242); color: rgb(90, 105, 134); " title="RGB (222, 229, 242)">a</div></td><td><div style="background-color: rgb(224, 236, 255); color: rgb(32, 108, 255); " title="RGB (224, 236, 255)">a</div></td><td><div style="background-color: rgb(223, 226, 255); color: rgb(0, 0, 204); " title="RGB (223, 226, 255)">a</div></td><td><div style="background-color: rgb(224, 213, 249); color: rgb(82, 41, 163); " title="RGB (224, 213, 249)">a</div></td><td><div style="background-color: rgb(253, 233, 244); color: rgb(133, 79, 97); " title="RGB (253, 233, 244)">a</div></td><td><div style="background-color: rgb(255, 227, 227); color: rgb(204, 0, 0); " title="RGB (255, 227, 227)">a</div></td></tr><tr><td><div style="background-color: rgb(90, 105, 134); color: rgb(222, 229, 242); " title="RGB (90, 105, 134)">a</div></td><td><div style="background-color: rgb(32, 108, 255); color: rgb(224, 236, 255); " title="RGB (32, 108, 255)">a</div></td><td><div style="background-color: rgb(0, 0, 204); color: rgb(223, 226, 255); " title="RGB (0, 0, 204)">a</div></td><td><div style="background-color: rgb(82, 41, 163); color: rgb(224, 213, 249); " title="RGB (82, 41, 163)">a</div></td><td><div style="background-color: rgb(133, 79, 97); color: rgb(253, 233, 244); " title="RGB (133, 79, 97)">a</div></td><td><div style="background-color: rgb(204, 0, 0); color: rgb(255, 227, 227); " title="RGB (204, 0, 0)">a</div></td></tr><tr><td><div style="background-color: rgb(255, 240, 225); color: rgb(236, 112, 0); " title="RGB (255, 240, 225)">a</div></td><td><div style="background-color: rgb(250, 220, 179); color: rgb(179, 109, 0); " title="RGB (250, 220, 179)">a</div></td><td><div style="background-color: rgb(243, 231, 179); color: rgb(171, 139, 0); " title="RGB (243, 231, 179)">a</div></td><td><div style="background-color: rgb(255, 255, 212); color: rgb(99, 99, 48); " title="RGB (255, 255, 212)">a</div></td><td><div style="background-color: rgb(249, 255, 239); color: rgb(100, 153, 44); " title="RGB (249, 255, 239)">a</div></td><td><div style="background-color: rgb(241, 245, 236); color: rgb(0, 102, 51); " title="RGB (241, 245, 236)">a</div></td></tr><tr><td><div style="background-color: rgb(236, 112, 0); color: rgb(255, 240, 225); " title="RGB (236, 112, 0)">a</div></td><td><div style="background-color: rgb(179, 109, 0); color: rgb(250, 220, 179); " title="RGB (179, 109, 0)">a</div></td><td><div style="background-color: rgb(171, 139, 0); color: rgb(243, 231, 179); " title="RGB (171, 139, 0)">a</div></td><td><div style="background-color: rgb(99, 99, 48); color: rgb(255, 255, 212); " title="RGB (99, 99, 48)">a</div></td><td><div style="background-color: rgb(100, 153, 44); color: rgb(249, 255, 239); " title="RGB (100, 153, 44)">a</div></td><td><div style="background-color: rgb(0, 102, 51); color: rgb(241, 245, 236); " title="RGB (0, 102, 51)">a</div></td></tr></tbody></table>';function renderAddressShortcuts(){var b=$("#address-shortcut-opt");if(b.length==0){function a(e){shortcut=b.data("shortcut");var d=prompt($I.R030,shortcut.name);if(d){$.ajax({type:"POST",url:"shortcut/rename",data:{id:shortcut.key,name:d},success:function(){showNotice($I.R034({name:d}));renderAddressShortcuts();b.hide()},error:function(){showError($I.R035({name:shortcut.name}))}})}e.stopPropagation()}function c(d){shortcut=b.data("shortcut");if(confirm($I.R036)){$.ajax({type:"POST",url:"shortcut/delete",data:{id:shortcut.key},success:function(){showNotice($I.R037({name:shortcut.name}));renderAddressShortcuts();b.hide()},error:function(){showError($I.R038({name:shortcut.name}))}})}d.stopPropagation()}b=$('<div id="address-shortcut-opt"/>').append($('<div class="menu-item"/>').append($('<a href="javascript:void(0)"/>').text($I.R039).click(a))).append($('<div class="menu-item"/>').append($('<a href="javascript:void(0)"/>').text($I.R014).click(c))).append($('<div class="menu-item"/>').append($('<span class="label"/>').text($I.R040))).append($('<div class="menu-item"/>').html(colorTable));$(".color-table td div",b).click(function(d){b.hide();shortcut=b.data("shortcut");var e=$(this);$.ajax({type:"POST",url:"shortcut/color",data:{id:shortcut.key,background:e.css("background-color"),font:e.css("color")},success:function(){showNotice($I.R041({name:shortcut.name}));renderAddressShortcuts()},error:function(){showError($I.R042({name:shortcut.name}))}});d.stopPropagation()})}$.getJSON("shortcut/",function(d){if(d.length==0){return}$("#address-shortcut").empty();$.each(d,function(g,f){var e=f.name,j=[];var i=$('<div class="box" />'),h=i.clone().append($("<div/>").text(e));$.each(f.info,function(){j.push(this.url);h.append($('<span class="item"/>').append($("<img />").attr("src",STATIC_URL+"images/"+this.service+".png"),$('<span class="name"/>').text(this.name)))});i.append($('<a class="item"/>').text(e).tipTip({delay:100,maxWidth:"100%",content:h}),$('<div class="address-shortcut-opt-button"/>').text("▼").css({color:f.fontColor,"background-color":f.backgroundColor}).smallMenu({target:b,ondisplay:function(){b.data("shortcut",f)}})).click(function(){showPostMessageDialog("",j);$("#address-shortcut").hide()}).appendTo($("#address-shortcut"))});$(document).click(function(){b.hide()})})}function renderMsgCommand(){var a=$("#message-command");a.find(".menu-item").click(function(c){var b=currentMsg.data($(this).attr("rel"));if(b){b()}c.stopPropagation()});a.find(".menu-group").mouseover(function(){$(this).addClass("active");var b=$(".menu-group-cover",this);clearTimeout(b.data("timer"));b.show()}).mouseout(function(){$(this).removeClass("active");var b=$(".menu-group-cover",this);var c=setTimeout(function(){b.hide()},300);b.data("timer",c)});a.mouseover(function(){$(this).show()}).mouseout(function(){$(this).hide()}).mousewheel(function(){$(this).hide()});$(".message").livequery("mouseover",function(c){var b=$(this);if(b.parents(".column").length==0){return}if(onScrolling){return}if(msgCommandTimer>0){clearTimeout(msgCommandTimer)}msgCommandTimer=setTimeout(function(){var d=b.parents(".column").data("conf").service;var e=$("#message-command");var f=b.parents(".ui-dialog").css("z-index")||2;e.css({"z-index":parseInt(f)+1,left:0});e.find(".menu-item, .menu-group").hide();e.find(".menu-item").each(function(){var j=$(this);var k=j.attr("rel");if(!!b.data(k)){j.show();j.parents(".menu-group").show()}});var i=b.offset();e.show();var h=i.left+b.innerWidth()-e.outerWidth();if(d=="twitter"){var g=i.top+b.innerHeight()-e.outerHeight();e.css({top:g,left:h})}else{e.css({top:i.top,left:h})}currentMsg=b},200);c.stopPropagation()});$("#message-command").mouseover(function(){if(msgCommandTimer>0){clearTimeout(msgCommandTimer)}});$(".tab-content").mouseout(function(){if(msgCommandTimer>0){clearTimeout(msgCommandTimer)}msgCommandTimer=setTimeout(function(){$("#message-command").hide()},100)})}function buildSearch(){$("#search-form").submit(function(d){d.preventDefault();var b=$("#search-keyword").val();if(!$.trim(b)){return false}$("#search-keyword").val("");var h=$('<p class="loading"/>').text("Loading...");var a=$('<div class="twitter"/>').append(h).appendTo(document.body);var c="search/"+b;var g="";var f={name:b+"/Search",service:"twitter",account_name:"",account_label:"Search",type:c};var e=twitter.getOtherAccount();if(e.length==0){alert($I.R103);return}else{g=e[0].account_name}a.dialog({title:$I.R071+" / "+b,height:400,width:400,dialogClass:"thread",open:function(){$.get("twitter/messages/"+g+"?type="+encodeURIComponent(c),function(i){h.remove();$.each(i.messages,function(j,k){twitter.renderMessage(k,f).appendTo(a)})})},close:function(i,j){a.remove()},buttons:[{text:$I.R027,click:function(){if(e.length==0){alert($I.R103)}else{if(e.length==1){f.account_name=e[0].account_name;f.account_label=e[0].account_name;addColumn(f,function(){a.dialog("close")})}else{var k=$("<img/>"),i=$("<select/>"),j=$('<div class="tw-select-accounts"/>').append($('<div class="label"/>').text($I.R104),$('<div class="tw-accounts-pulldown"/>').append(k,i));$.each(e,function(){$("<option/>").text(this.account_name).val(this.account_name).data("account",this).appendTo(i)});k.attr("src",e[0].profile_image_url);i.change(function(){var l=$("option:selected",i).data("account");k.attr("src",l.profile_image_url)});j.dialog({modal:true,buttons:[{text:$I.R027,click:function(){var l=$("option:selected",i).val();f.account_name=l;f.account_label=l;addColumn(f,function(){j.dialog("close");a.dialog("close")})}}]})}}}}]})})}var currentMessageIndex=1;function changeFooterMessage(){$("#message"+currentMessageIndex).fadeOut(function(){var a=$("#message"+(++currentMessageIndex));if(a.length==0){currentMessageIndex=1;a=$("#message"+currentMessageIndex)}a.fadeIn()})}function showNotification(c,b,a){if(!window.webkitNotifications||!notificationStatus){return}if(window.webkitNotifications.checkPermission()==0){if(!a){a=STATIC_URL+"images/crowy_75x75.png"}var d=window.webkitNotifications.createNotification(a,c,b);d.ondisplay=function(){var e=this;setTimeout(function(){if(e.cancel){e.cancel()}},7000)};d.show()}}function toggleNotification(){if(!window.webkitNotifications){alert($I.R007);return}function a(b){$.ajax({type:"POST",url:"settings/update",data:{notification:b,type_notification:"bool"},success:function(){showNotice($I.R043);notificationStatus=b;$("#desktop-notifier").attr("class",b?"notifier-on":"notifier-off")},error:function(){showError($I.R044)}})}if(!window.webkitNotifications){notificationStatus=false;return}if(notificationStatus){a(false)}else{if(window.webkitNotifications.checkPermission()!=0){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()==0){a(true)}})}else{a(true)}}}function _showNotice(c,a){var b=$("#notice").show();$("<div/>").toggleClass("error",a).text(c).appendTo(b).fadeIn("slow").delay(1000).fadeOut("slow",function(){$(this).remove();if($("div",b).length==0){b.hide()}})}function showNotice(a){_showNotice(a,false)}function showError(a){_showNotice(a,true)}function showNotificationCount(b,c){var a=b.name+(b.account_label?(" / "+b.account_label):"");if(c<=0){$("#s-"+b.key).removeClass("new").attr("title",a).tipTip(tipConf);return}$("#s-"+b.key).addClass("new").attr("title","("+c+") "+a).tipTip(tipConf)}var tzoffset=new Date().getTimezoneOffset()*60000;function to2(a){return a<10?"0"+a:a}function formatDate(a){yyyy=a.getFullYear();mm=to2(a.getMonth()+1);dd=to2(a.getDate());hh=to2(a.getHours());MM=to2(a.getMinutes());ss=to2(a.getSeconds());return yyyy+"-"+mm+"-"+dd+" "+hh+":"+MM+":"+ss}function toLocalTime(b){var a=new Date(Date.parse(b)-tzoffset);return formatDate(a)}function getTimeUTC(a){return Date.parse(a)-tzoffset}function toTweetTimestampStr(g){var c=new Date().getTime();var b=c-g;b/=1000;var f=Math.round(b);if(f<60){return[$I.R110({second:f}),true]}b/=60;var e=Math.round(b);if(e<60){return[$I.R111({minute:e}),true]}b/=60;var a=Math.round(b);if(a<24){return[$I.R112({hour:a}),true]}var h=new Date(g);return[$.datepicker.formatDate($I.R109,h),false]}var updateTimestampTimerInterval=57*1000;function updateTimestamp(){$(".relative-time").each(function(){var d=$(this).data("time");var b=toTweetTimestampStr(d);var c=b[0],a=b[1];$(this).find("a").text(c);if(!a){$(this).removeClass("relative-time")}})}function createTimestampDiv(a,h,d){var i={title:toLocalTime(a)};if(!d){i={href:h,target:"_blank",title:toLocalTime(a)}}var e=getTimeUTC(a);var g=toTweetTimestampStr(e);var f=g[0],c=g[1];var b=$.DIV({className:"time"},$.A(i,f));b.data("time",e);if(c){b.addClass("relative-time")}return b}function buildURL(b,c){b+="?";var a=0;$.each(c,function(d,e){if(a++>0){b+="&"}b+=encodeURIComponent(d)+"="+encodeURIComponent(e)});return b}function createAmazonLink(a,b){if(a){if(!b.redirect_off&&a.match(/http:\/\/amzn.to\/.*/)){expandUrl(a,function(c){b.redirect_off=true;b.success(createAmazonLink(c,b))});return}else{if(a.match(/http:\/\/www\.amazon\.co\.jp\/.*/)){a=a.replace(/(\?|&)tag=([^&]+)/,"");a=a.replace(/\/[\w]+-[0-9]+\//,"/");if(a.indexOf("?")>0){a+="&tag="+AMAZON_ASSOCIATES_ID}else{a+="?tag="+AMAZON_ASSOCIATES_ID}b.success(a,b)}}}}$(function(){function a(){if(!currentTab){return}currentTab.find(".column").each(function(d,e){currentTab.queue(function(){loadColumn($(e),true)})})}function c(){$("#tabs .tab").each(function(d,e){var e=$(e);if(e.attr("id")!=currentTab.attr("id")){$(".column",e).each(function(f,g){tabs.queue(function(){loadColumn($(g),true)})})}})}if($.browser.webkit){$(document.body).addClass("webkit")}if(!navigator.userAgent.toLowerCase().indexOf("Mac OS X 10.7")){$(document.body).addClass("notlion")}initMessagePost();renderAddressShortcuts();$("#multiPost-bookmark").click(function(d){$("#address-shortcut").show();d.stopPropagation()});$("#address-shortcut").click(function(d){d.stopPropagation()});$(document).click(function(){$("#address-shortcut").hide()});renderTabs();renderMsgCommand();$("#user-menu").smallMenu({target:$("#top-menu-more"),appended:true,position:{top:"36px",right:"10px"},ondisplay:function(){$("#user-menu").addClass("focus")},onclose:function(){$("#user-menu").removeClass("focus")}});$("#refresh-tab").click(a);reloadTimer=setInterval(a,5*60*1000);setTimeout(c,10*1000);reloadBackTimer=setInterval(c,60*60*1000);updateTimestampTimer=setInterval(updateTimestamp,updateTimestampTimerInterval);$("#settings").click(showSettings);buildSearch();setInterval(changeFooterMessage,5*60*1000);var b=-1;$(window).blur(function(){if(b){clearTimeout(b)}b=setTimeout(function(){$("#tabs .message-list").each(function(){var d=$(".message:gt("+(maxMessageCount-1)+")",this);d.first().nextAll(".gap, .gap-loading").remove();d.remove()})},300000)}).focus(function(){if(b){clearTimeout(b)}}).unload(function(){$.post("account/removecache");$.post("file/delete")});$("#logout").click(function(d){if(loginService=="google"){d.preventDefault();$('<div id="logout-google"/>').text($I.R105).dialog({modal:true,minHeight:0,buttons:[{text:$I.R106,click:function(){$(this).dialog("close");location.href="logout"}},{text:$I.R107,click:function(){$(this).dialog("close");location.href="logout?google=1"}}]})}});setTimeout(function(){var e=$("#notification-switch");var d=$($I.R045);e.tipTip({maxWidth:"300px",content:d});$("#desktop-notifier").attr("class",window.webkitNotifications&&notificationStatus?"notifier-on":"notifier-off")},500)});function removeAccount(a,c,b){if(!confirm($I.R046({name:(b||c)}))){return}$.ajax({type:"POST",url:"account/remove",data:{service:a,name:c},success:function(){showNotice($I.R047);location.reload()},error:function(){showError($I.R048)}})}var youroom={messageLimit:280,canUploadImage:true,canPostInColumn:function(b,a){return a.type!=""},getPostUrl:function(a){if(a.type){return"youroom/post/"+a.account_name+"/"+a.type}return""},getDefaultColumnInfo:function(b,a){return[{name:"Home",account_label:b,account_name:b,type:"",notification:false}]},getColumnLink:function(a){var b=a.type;if(b==""){return"https://www.youroom.in/"}return"https://www.youroom.in/r/"+b},getIconClass:function(a){return"icon-"+a.service},onErrorGroupImage:function(b,c,d,a){b.src="youroom/api/"+c.account_name+"?url="+encodeURIComponent(a)},onErrorProfileImage:function(b,c,d,a){b.src="youroom/api/"+c.account_name+"?url="+encodeURIComponent(d)},baseUrl:"https://www.youroom.in/r/",renderMessage:function(k,d,i,e){var c=k.participation,h=(c.group&&c.group.to_param)||e.room_id;var f=$.DIV({className:"message"},$.A({href:youroom.baseUrl+h+"/participations/"+c.id,className:"profile-image",target:"_blank"},$.IMG({src:youroom.baseUrl+h+"/participations/"+c.id+"/picture"}).error(function(){$(this).unbind("error");var l=youroom.baseUrl+h+"/participations/"+c.id+"/picture";this.src="youroom/api/"+d.account_name+"?url="+encodeURIComponent(l);$(this).error(function(){$(this).unbind("error");this.src="https://www.youroom.in/images/default_picture.png"})})),$.A({href:youroom.baseUrl+h+"/participations/"+c.id,className:"user-name",target:"_blank"},c.name),$.DIV({className:"time"},$.A({href:youroom.baseUrl+h+"/entries/"+k.root_id,target:"_blank"},toLocalTime(k.display_time))),$.DIV({className:"message-text"}).html(k.display_text)).data("reply",function(){if(youroom.canPostInColumn(null,d)){openColumnInput(false,d,"",k.id,k.content)}else{var l=d.account_name;showPostMessageDialog("","youroom/post/"+l+"/"+h,k.id,k.content)}}).data("entry",k);if(c.group){$(".user-name",f).after($.A({href:youroom.baseUrl+h,target:"_blank"},c.group?c.group.name:"")).after(" in ")}if(k.root_id){f.data("thread",function(){var l=$.DIV().append($('<p class="loading"/>').text("Loading...")).appendTo(document.body);l.dialog({title:$I.R049,height:400,width:400,dialogClass:"thread",open:function(m,n){$.get("youroom/thread/"+d.account_name+"/?room_id="+h+"&id="+k.root_id,function(o){l.empty();youroom.renderThread.apply(youroom,[o,l,d])})},close:function(m,n){l.remove()}})})}if(k.attachment){if(k.attachment.data){var e=k.attachment.data;if(e.url){var a=e.url;f.append($.A({href:a,target:"_blank"},a.length>40?a.substring(0,37)+"...":a))}else{if(e.text){f.append($.DIV({className:"message-text"}).text(e.text).hide(),$.A({className:"more",href:"#"},$I.R050).click(function(){var l=$(this).prev();if(l.css("display")=="none"){$(this).text($I.R051)}else{$(this).text($I.R050)}l.toggle()}))}}}else{var g=k.attachment,j=g.attachment_type,b={id:k.id,room_id:h,"content-type":g.content_type,name:g.filename};if(j=="Image"){$('<a target="_blank"/>').attr("href","https://www.youroom.in/r/"+h+"/entries/"+k.id+"/attachment").attr("target","_blank").append($('<img height="20"/>').attr("src",buildURL("youroom/attach/"+d.account_name,b)).attr("alt",g.filename)).appendTo($('<div class="images"/>').appendTo(f))}else{if(j=="File"){$("<a/>").text(g.filename).attr("href","https://www.youroom.in/r/"+h+"/entries/"+k.id+"/attachment").attr("target","_blank").appendTo($('<div class="files"/>').appendTo(f))}}}}return f},getEntry:function(a){return a.entry},getNotificationInfo:function(c,e,d){var a=c.participation,b=(a.group&&a.group.to_param)||e.room_id;return{title:a.name+" in "+d.name,message:c.content,icon:STATIC_URL+"images/youroom.png"}},renderThread:function(d,a,c){var b=d.messages.entry;youroom.renderMessage(b,c,false,false,d).appendTo(a);youroom.renderChildren(b.children,d,a,c,1)},renderChildren:function(c,e,b,d,a){if(!c){return}$.each(c,function(){youroom.renderMessage(this,d,false,false,e).css("margin-left",a*5+"px").appendTo(b);youroom.renderChildren(this.children,e,b,d,a+1)})},moreMessages:function(){var e=$(this);var a=e.prev(".message-list");var c=a.parents(".column").data("conf");var b=c.service+"/messages/"+c.account_name;var f=$(".message",a).length;var d=Math.floor(f/10)+1;e.hide().next().show();$.getJSON(buildURL(b,{type:c.type,page:d}),function(g){renderMessages(youroom,g,a,c);e.show().next().hide()})}};var twitter={name:"Twitter",messageLimit:140,canUploadImage:true,countMessage:function(d,f){var e=d.replace(/\s+$/g,"").length;var c=new RegExp("(http[s]?://[\\w|/|.|%|&|?|=|\\-|#|!|:|;|~]+)","g"),b=d.match(c);if(b){$.each(b,function(){if(this.length>20){e+=20-this.length}})}if(f.uploader("keys").length>0){e+=21}var a=twitter.messageLimit-e;return a},canPostInColumn:function(b,a){return true},typeToLink:{home_timeline:"http://twitter.com/",mentions:"http://twitter.com/#!/mentions",retweeted_by_me:"http://twitter.com/#!/retweets",retweeted_to_me:"http://twitter.com/#!/retweets_by_others",retweets_of_me:"http://twitter.com/#!/retweeted_of_mine",direct_messages:"http://twitter.com/#!/messages","direct_messages/sent":"http://twitter.com/#!/messages"},getColumnLink:function(a){try{var b=a.type;if(b.indexOf("search/")==0){return"http://twitter.com/#!/search/"+encodeURIComponent(b.substring(7))}else{if(b.indexOf("list/")==0){return"http://twitter.com/#!/"+b.substring(5)}else{if(b=="user_timeline"){return"http://twitter.com/#!/"+encodeURIComponent(a.account_name)}else{if(b=="favorites"){return"http://twitter.com/#!/"+encodeURIComponent(a.account_name)+"/favorites"}}}}return twitter.typeToLink[b]}catch(c){return false}},getIconClass:function(a){return"icon-twitter"},afterBuildColumn:function(a){a.find(".icon-twitter").wrap('<a href="https://twitter.com" target="_blank"></a>')},getPostUrl:function(a){if(a.currentAccount){return a.currentAccount.url}return"twitter/post/"+a.account_name},getOtherAccount:function(a){var b=[];$.each(accounts,function(){if(this.url.match("^twitter/post/")&&(!a||twitter.getPostUrl(a)!=this.url)){b.push(this)}});return b},getDefaultColumnInfo:function(b,a){return[{name:"Home",account_label:b,account_name:b,type:"home_timeline",notification:false},{name:"Mentions",account_label:b,account_name:b,type:"mentions",notification:true}]},openColumnInput:function(c,b){var a=c.find(".message-input textarea");var d=a.val();if(!d&&b.type.match(/search\/(#[^\s]*)/)){d=" "+RegExp.$1}openColumnInput(c,b,d,"","",true)},openProfile:function(a,f,e){if(!f.account_name){return}if(e&&e.preventDefault){e.preventDefault()}var d="profile-"+new Date().getTime();var c=$('<div class="profile"/>').append($('<div class="profile-tabs twitter"/>').append($("<ul/>").append($('<li class="profile-tab"><a href="#profile-tab-'+d+'"><span/></a></li>'),$('<li class="timeline-tab"><a href="#timeline-tab-'+d+'"><span/></a></li>'),$('<li class="mention-tab"><a href="#mention-tab-'+d+'"><span/></a></li>'),$('<li class="favorites-tab"><a href="#favorites-tab-'+d+'"><span/></a></li>'),$('<li class="list-tab"><a href="#list-tab-'+d+'"><span/></a></li>')),$('<div id="profile-tab-'+d+'" class="profile-tabbody"/>'),$('<div id="timeline-tab-'+d+'" class="timeline-tabbody"/>'),$('<div id="mention-tab-'+d+'" class="timeline-tabbody"/>'),$('<div id="favorites-tab-'+d+'" class="timeline-tabbody"/>'),$('<div id="list-tab-'+d+'" class="list-tabbody"/>'))).appendTo(document.body).dialog({title:a.name||a.screen_name,width:400,height:440,resizable:false,open:function(){$(".timeline-tabbody",this).append($('<div class="panel"/>'),$('<div class="buttons"/>').append($('<div class="button addcolumn-btn"/>').append($('<a href="#"/>').text($I.R027).click(function(){var i=$(this).parents(".timeline-tabbody").data("conf");if(i){addColumn(i)}}))));$(this).find(".profile-tabs").tabs({select:function(m,n){var i=$(".panel",n.panel),l=n.panel.id;function k(o){$(n.panel).data("conf",o);var p=$('<p class="loading"/>').text("Loading...");i.empty().append(p);$.get("twitter/messages/"+f.account_name+"?type="+encodeURIComponent(o.type),function(q){p.remove();$.each(q.messages,function(r,s){twitter.renderMessage(s,o).appendTo(i)})})}if(l.indexOf("timeline-tab-")==0){var j={name:"From:"+a.screen_name,service:"twitter",account_name:f.account_name,account_label:f.account_name,type:"user/"+a.screen_name};k(j)}else{if(l.indexOf("mention-tab-")==0){var j={name:"To:"+a.screen_name,service:"twitter",account_name:f.account_name,account_label:f.account_name,type:"mentions/"+a.screen_name};k(j)}else{if(l.indexOf("favorites-tab-")==0){var j={name:"Fav:"+a.screen_name,service:"twitter",account_name:f.account_name,account_label:f.account_name,type:"favorites/"+a.screen_name};k(j)}}}}})}});function h(j){var l=twitter.getOtherAccount();var i=$('<div class="profilePanel panel"/>').append($('<div class="userInfo"/>').append($('<a class="open-twitter"/>').append($('<img class="userIcon"/>').attr("src",j.profile_image_url)),$('<a class="userName open-twitter"/>').text(j.name),$('<p class="additionalInfo"/>').append($('<a class="accountName open-twitter"/>').text("@"+j.screen_name),$('<span class="userLocation"/>').text(j.location)),$('<p class="userWeb"/>').append($('<a target="_blank"/>').attr("href",j.url).text(j.url))),j.description?$('<div class="userDescription"/>').append($("<p/>").text(j.description)):false,$('<table class="tweetNumbers"/>').append($("<tbody/>").append($("<tr/>").append($('<td class="following"/>').append($('<a class="tweetNum"/>').text(j.friends_count),$('<a class="tweetLabel"/>').text($I.R092)),$('<td class="followers"/>').append($('<a class="tweetNum"/>').text(j.followers_count),$('<a class="tweetLabel"/>').text($I.R093))),$("<tr/>").append($('<td class="tweets"/>').append($('<a class="tweetNum"/>').text(j.statuses_count),$('<a class="tweetLabel"/>').text($I.R094)).click(function(){$(".profile-tabs",c).tabs("select",1)}),$('<td class="favorites"/>').append($('<a class="tweetNum"/>').text(j.favourites_count),$('<a class="tweetLabel"/>').text($I.R095)).click(function(){$(".profile-tabs",c).tabs("select",3)}))))),k=$('<div class="profileBtns buttons"/>').append($('<div class="button follow-manage"/>').append($('<a href="#"/>').text($I.R096).click(function(){i.toggleClass("open-friendships");var m=$(".friendships",i);if(m.length>0){if(m.is(":visible")){m.animate({bottom:"hide"},"fast")}else{m.animate({bottom:"show"},"fast")}return}function n(q){var p=$(".friendships-account span",q).text();$.getJSON("twitter/api/"+p,{path:"friendships/lookup.json?screen_name="+j.screen_name},function(v){var u=v[0].connections;var r=u.indexOf("following")>=0,y=u.indexOf("followed_by")>=0,x=u.indexOf("following_requested")>=0;var t=$I.R097,w="friend";if(!r&&y){t=$I.R098;w="fan"}else{if(r&&!y){t=$I.R099;w="following"}else{if(!r&&!y){t="";w="norelation"}}}$(".friendships-status span",q).text(t);$(".friendships-status-icon div",q).attr("class",w);var s=r?"unfollow-btn":(x?"following-requested":"follow-btn");$(".friendships-button > div",q).hide();$(".friendships-button ."+s,q).show()})}var o=$('<table class="friendships-table"/>');$.each(l,function(){if(j.screen_name==this.account_name){return true}var p=this;$("<tr/>").append($('<td class="friendships-img"/>').append($("<img/>").attr("src",this.profile_image_url)),$('<td class="friendships-account"/>').append($("<span/>").text(this.account_name)),$('<td class="friendships-status-icon"/>').append($("<div/>")),$('<td class="friendships-status"/>').append($("<span/>").text("Loading...")),$('<td class="friendships-button"/>').append($('<div class="button follow-btn"/>').append($('<a href="#"/>').text($I.R090).click(function(){var t="friendships/create.json",q="twitter/api/"+p.account_name+"?path="+encodeURIComponent(t),s={screen_name:j.screen_name},r=$(this).parents("tr");$.ajax({type:"POST",url:q,data:s,success:function(){n(r)}})})),$('<div class="button unfollow-btn"/>').append($('<a href="#"/>').text($I.R091).click(function(){var t="friendships/destroy.json",q="twitter/api/"+p.account_name+"?path="+encodeURIComponent(t),s={screen_name:j.screen_name},r=$(this).parents("tr");$.ajax({type:"POST",url:q,data:s,success:function(){n(r)}})})),$('<div class="following-requested"/>').text($I.R100))).appendTo(o)});$('<div class="friendships"/>').append(o).hide().appendTo(i).animate({bottom:"show"},"fast");$("tr",o).each(function(){n($(this))})})),$('<div class="button dm-btn"/>').append($('<a href="#"/>').text($I.R101)),$('<div class="button reply-btn"/>').append($('<a href="#"/>').text($I.R102)));if(l.length==1&&l[0].account_name==j.screen_name){$(".follow-manage",k).hide()}$(".userInfo a.open-twitter",i).attr({target:"_blank",href:"http://twitter.com/"+j.screen_name});$(".profile-tabbody",c).empty().append(i,k)}if(!a.friends_count){var g="users/show.json?screen_name="+a.screen_name;var b="twitter/api/"+f.account_name+"?path="+encodeURIComponent(g);$('<p class="loading"/>').text("Loading...").appendTo($(".profile-tabbody",c));$.getJSON(b,function(i){c.dialog("option","title",i.name);h(i)})}else{h(a)}},renderMessage:function(d,c,h,x,p){var b="http://twitter.com/";var y=d.user||d.sender;var s=c.type.indexOf("direct_messages")==0,m=c.type=="direct_messages/sent";if(m){y=d.recipient||y}var w=b+y.screen_name+"/status/"+d.id;var i=$.DIV({className:"message"},$.A({href:b+y.screen_name,className:"profile-image open-profile",target:"_blank"},$.IMG({src:y.profile_image_url}),y["protected"]?$("<img/>").attr("src",STATIC_URL+"images/protect.png").addClass("protect"):null),$.A({href:b+y.screen_name,className:"user-name open-profile",target:"_blank"},$.SPAN({className:"user-fullname"},y.name||""),(m?"To: ":"")+"@"+y.screen_name),createTimestampDiv(d.display_time,w,s),$.DIV({className:"message-text"})).data("entry",d).data("id",d.id_str);var g=$('<div class="images"/>');i.append(g);var t="";if(d.entities){var j=[];$.each(d.entities,function(z,A){j=j.concat(A)});j.sort(function(A,z){return A.indices[0]>z.indices[0]});var o=d.text,v=0;$.each(j,function(){if(this.indices[0]>0){t+=o.substring(v,this.indices[0])}if(this.screen_name){t+='<a href="http://twitter.com/'+this.screen_name+'" target="_blank" class="open-profile" screen_name="'+this.screen_name+'">@'+this.screen_name+"</a>"}if(this.text){t+='<a href="http://twitter.com/#!/search/%23'+encodeURIComponent(this.text)+'" target="_blank">#'+this.text+"</a>"}if(this.url){t+='<a href="'+this.url+'" target="_blank">'+(this.display_url||this.url)+"</a>";getImageThumb((this.expanded_url||this.url),function(A){var z=$(A.thumb).load(function(){createAmazonLink(A.original,{type:"amazon",friend_name:y.full_name||y.screen_name,friend_url:b+"/"+y.screen_name,body:t,banner_url:this.src,success:function(C){B.attr("href",C)}})});var B=$('<a target="_blank"/>').attr("href",A.original).append(z.error(function(){var C=$(this);if(!C.data("errorCount")){C.data("errorCount",1);setTimeout(function(){C.attr("src",C.attr("src")).error(function(){$(this).parent().remove()})},1000)}})).appendTo(g)})}v=this.indices[1]});t+=o.substring(v)}if(d.is_search||!d.entities){if(!d.entities||!d.entities.urls){t=d.text;t=t.replace(/(http[s]?:\/\/[\w|\/|\.|%|&|\?|=|\-|#|!|:|;|~]+)/g,'<a href="$1" target="_blank">$1</a>')}t=t.replace(/@([\w|\/|\.|%|&|\?|=|\-|#]+)/g,'<a href="http://twitter.com/$1" target="_blank" class="open-profile" screen_name="$1">@$1</a>');t=t.replace(/(?:#|\uFF03)([a-zA-Z0-9_\u3041-\u3094\u3099-\u309C\u30A1-\u30FA\u30FC\u3400-\uD7FF\uFF10-\uFF19\uFF20-\uFF3A\uFF41-\uFF5A\uFF66-\uFF9F]+)(?![^\<]*\")/g,'<a href="http://twitter.com/#!/search/%23$1" target="_blank">#$1</a>')}t=t.replace(/\n/g,"<br/>");i.find(".message-text").html(t);$(".open-profile",i).click(function(A){var B=$(this).attr("screen_name");var z=y;if(B){z={screen_name:B}}twitter.openProfile(z,c,A)});function r(){var z=c.account_name;openColumnInput(i.parents(".column"),c,"d "+y.screen_name+" ","")}if(!s){if(d.favorited){i.addClass("favorited").data("unfavorite",function(){var z="twitter/api/"+c.account_name+"?path="+encodeURIComponent("favorites/destroy.json");$.ajax({type:"POST",url:z,data:{id:d.id},success:function(){d.favorited=false;showNotice($I.R083);var A=twitter.renderMessage(d,c);i.replaceWith(A)},error:function(){showError($I.R084)}})})}else{i.data("favorites",function(){$.ajax({type:"POST",url:"twitter/favorites/"+c.account_name+"?id="+d.id,success:function(){d.favorited=true;showNotice($I.R056);var z=twitter.renderMessage(d,c);i.replaceWith(z)},error:function(){showError($I.R057)}})})}i.data("dm",r).data("reply",function(){var z=c.account_name;openColumnInput(i.parents(".column"),c,"@"+y.screen_name+" ",d.id,d.text)}).data("rt",function(){var z=$("<span/>").html(d.text).text();var A=c.account_name;openColumnInput(i.parents(".column"),c," RT @"+y.screen_name+": "+z,"","",true)});if(!y["protected"]){i.data("retweet",function(){var A=accountsMap[twitter.getPostUrl(c)];var B=twitter.getOtherAccount();var z=$('<div class="retweet-accounts"/>');$.each(B,function(){$('<label class="retweet-account"/>').append($('<input type="checkbox"/>').val(this.account_name).attr("checked",this.account_name==A.account_name),$("<img/>").attr("src",this.profile_image_url),$('<span class="account-name"/>').text(this.account_name)).appendTo(z)});$("<div/>").append($('<div class="retweet-dialog"/>').append($('<div class="label"/>').text($I.R053),$('<div class="tweet"/>').text(d.text),z)).dialog({title:$I.R089,width:300,buttons:[{text:$I.R026,click:function(){$(this).dialog("close")}},{text:$I.R089,click:function(){var C=z.find("input:checked");C.each(function(){var D=$(this).val();$.ajax({type:"POST",url:"twitter/retweet/"+D+"?id="+d.id,success:function(){showNotice($I.R054({account:D}))},error:function(){showError($I.R055({account:D}))}})});if(C.length>0){$(this).dialog("close")}}}]})})}var k=d.text.match(/@[a-zA-Z0-9_]+/g);if(k&&k.length>0){var l=c.account_name;if(k.length==1&&k[0]=="@"+l){}else{i.data("replyall",function(){var A="";if(y.screen_name!=l){A+="@"+y.screen_name+" "}for(var z=0;z<k.length;z++){if(k[z]!="@"+y.screen_name&&k[z]!="@"+l){A+=k[z]+" "}}openColumnInput(i.parents(".column"),c,A,d.id,d.text)})}}if(y.screen_name==c.account_name){i.data("delete",function(){if(!confirm($I.R082({tweet:d.text}))){return false}var z="twitter/api/"+c.account_name+"?path=statuses/destroy/"+d.id+".json";$.ajax({type:"POST",url:z,data:{id:d.id},success:function(){showNotice($I.R080);i.remove()},error:function(){showError($I.R081)}})})}}else{i.data("reply",r);if((d.user||d.sender).screen_name==c.account_name){i.data("delete",function(){if(!confirm($I.R082({tweet:d.text}))){return false}var z="twitter/api/"+c.account_name+"?path=direct_messages/destroy.json";$.ajax({type:"POST",url:z,data:{id:d.id},success:function(){showNotice($I.R080);i.remove()},error:function(){showError($I.R081)}})})}}if(d.entities&&d.entities.media){var e=d.id+"_"+new Date().getTime();if(d.entities&&d.entities.media){$.each(d.entities.media,function(){$('<a target="_blank"/>').attr("href",this.media_url).append($("<img/>").attr("src",this.media_url+":thumb").error(function(){$(this).parent().remove()})).colorbox({maxWidth:"100%",maxHeight:"100%",rel:e}).appendTo(g)})}}if(d.retweet_user){var u=d.retweet_user.name;var n=null;if(d.retweet_count>1){n=$I.R073({account:u,count:d.retweet_count-1})}else{n=$I.R072({account:u})}i.addClass("retweeted").append($('<a class="rt-user" href="#"/>').text(n).click(function(){var z=$.DIV().append($('<p class="loading"/>').text("Loading...")).appendTo(document.body);z.dialog({title:n,height:400,width:400,dialogClass:"likes",open:function(A,B){$.getJSON("/twitter/api/"+c.account_name,{path:"statuses/retweets/"+d.rt_id+".json"},function(C){z.empty();if(!C||C.length==0){z.text($I.R085);return}$.each(C,function(){var D=this.user;$('<div class="like-user"/>').append($("<a/>").attr({href:"http://twitter.com/"+D.screen_name,target:"_blank"}).text(D.screen_name+" / "+D.name).click(function(E){twitter.openProfile(D,c,E)}).append($("<img/>").attr("src",D.profile_image_url))).appendTo(z)})})},close:function(A,B){z.remove()},buttons:[{text:$I.R018,click:function(){$(this).dialog("close")}}]})}))}if((!p||!p.is_conversation)&&(d.in_reply_to_status_id||(d.is_search&&d.text.indexOf("@")==0))){var a=$('<a class="conversation" href="#"/>').text($I.R049).click(function(){var C=$('<p class="loading"/>').text("Loading...");var z=$('<div class="column twitter"/>').data("id",d.id_str).append($("<div/>"),C).appendTo(document.body);function A(D){$.get("twitter/status/"+c.account_name+"/?id="+D,function(F){var E=twitter.renderMessage(F,c,null,null,{is_conversation:true}).insertAfter(C);if(F.in_reply_to_status_id){A(F.in_reply_to_status_id)}else{z.find(".message:last").data("reply")();closeColumnInput(focusedColumnInput);C.hide()}})}function B(D){z.find(".message").remove();C.show();if(D){A(D)}else{if(d.in_reply_to_status_id){twitter.renderMessage(d,c,null,null,{is_conversation:true}).insertAfter(C);A(d.in_reply_to_status_id)}else{A(d.id)}}}z.dialog({title:$I.R049,height:400,width:400,dialogClass:"thread",open:function(){$('<a href="#" class="ui-dialog-titlebar-close ui-corner-all refresh"><span class="ui-icon ui-icon-refresh"/></a>').hover(function(){$(this).toggleClass("ui-state-hover")}).click(function(){B()}).appendTo(z.parent().find(".ui-dialog-titlebar"));createColumnInput(twitter,z,c,C.prev());B();renderAccountImage(twitter,z,c)},close:function(D,E){z.remove()}}).data("reload",B)}).appendTo(i)}if(d.source){var q="from "+d.source;var f=$('<div class="source">'+q+"</div>");f.find("a").attr("target","_blank");i.append(f)}return i},getCreatedAt:function(a){return Number(a.id_str)},getNotificationInfo:function(c,e,d){var b=c.user||c.sender;var a=$("<span/>").html(c.text).text();return{title:(b.screen_name+(b.name?" ("+b.name+")":""))+" in "+d.name,message:a,icon:b.profile_image_url}},getGapMessages:function(){var g=$(this),a=g.parent(),e=a.parents(".column"),c=e.data("conf"),b=c.service+"/messages/"+c.account_name,f=g.prev(),d=f.data("entry").id;g.hide().next().show();$.getJSON(buildURL(b,{type:c.type,max_id:d}),function(i){var h=a.parent().offset().top-a.offset().top;i.messages.shift();renderMessages(twitter,i,a,c,g);a.parent().scrollTop(h)})},moreMessages:function(){var g=$(this),a=g.prev(".message-list"),e=a.parents(".column"),c=e.data("conf"),b=c.service+"/messages/"+c.account_name,f=a.children(".message:last"),d=f.data("entry")?f.data("entry").id:null;g.hide().next().show();$.getJSON(buildURL(b,{type:c.type,max_id:d}),function(h){renderMessages(twitter,h,a,c);g.show().next().hide()})}};var yammer={name:"Yammer",messageLimit:-1,canUploadImage:true,canPostInColumn:function(){return true},getColumnLink:function(a){if(a.href){return a.href}if(a.type.match(/^(in_group)\/([^\/]+)/)){return"https://www.yammer.com/"+a.account_name+"/groups/"+RegExp.$2}return"https://www.yammer.com/"+a.account_name+"#/threads/index?type="+a.type},getIconClass:function(a){return"icon-"+a.service},getPostUrl:function(a){var b=a.account_name;if(a.type.match(/^(in_group)\/([^\/]+)/)){groupid=RegExp.$2;return"yammer/post/"+b+"/"+groupid}return"yammer/post/"+b},getDefaultColumnInfo:function(b,a){return[{name:"My Feed",account_label:a,account_name:b,type:"following",notification:false}]},renderAttachment:function(h,b,c){if(h.attachments.length>0){var f=$('<div class="images"/>'),i=$('<div class="files"/>'),d=$('<div class="links"/>'),g=$('<div class="modules"/>'),e=h.id+"_"+new Date().getTime(),a=false;$.each(h.attachments,function(){var j=this;if(this.image){var l={url:this.image.url,name:this.name};var k={url:this.image.thumbnail_url,name:this.name};$('<a target="_blank"/>').attr("href",this.image.url).append($("<img/>").attr("alt",this.name).attr("src",this.image.thumbnail_url).error(function(){$(this).unbind("error");this.src=buildURL("yammer/attach/"+b.account_name,k);a=true;return true})).colorbox({href:function(){if(a){return buildURL("yammer/attach/"+b.account_name,l)}return j.image.url},maxWidth:"100%",maxHeight:"100%",rel:e,onComplete:function(){var m=$("#cboxError");if(m.length>0){$('<a target="_blank"/>').attr("href",this.href).text(j.name).appendTo(m)}}}).appendTo(f)}if(this.file){$('<a target="_blank"/>').text(this.name).attr("href",this.file.url).appendTo(i)}if(this.ymodule){if(this.ymodule.app_id=="blank"){$('<a target="_blank"/>').attr("href",this.web_url).append(this.name).appendTo(d)}else{$('<a target="_blank"/>').attr("href",this.web_url).append($('<img class="module-icon"/>').attr("src",this.ymodule.icon_url)).append(this.name).appendTo(g)}}c.append(g).append(f).append(i).append(d)})}},renderMessageCommon:function(c,d,b){var a=$.DIV({className:"message",id:d.key+"_"+c.id},$.A({href:c.sender.web_url,className:"profile-image",target:"_blank"},$.IMG({src:c.sender.mugshot_url})),$.A({href:c.sender.web_url,className:"user-name",target:"_blank"},c.sender.full_name||c.sender),$.DIV({className:"time"},$.A({href:c.web_url,target:"_blank"},toLocalTime(c.display_time))," from ",$.A({href:c.client_url,target:"_blank"},c.client_type)),$.DIV({className:"message-text"}).html(c.display_text)).data("reply",function(){var e=d.account_name;openColumnInput(b||a,d,"",c.id,c.body.plain)}).data("like",function(){$.ajax({type:"POST",url:"yammer/like/"+d.account_name+"?id="+c.id,success:function(){showNotice($I.R060);var e=c.liked_by?c.liked_by.count:0;var f=a.find(".likes-count:first");if(!f.data("liked")){f.text((e+1)+" likes").data("liked",true)}},error:function(){showError($I.R061)}})}).data("entry",c);yammer.renderAttachment(c,d,a);$.A({className:"likes-count",href:"#"},(c.liked_by?c.liked_by.count:0)+" likes").click(function(){var e=$.DIV().append($('<p class="loading"/>').text("Loading...")).appendTo(document.body);e.dialog({title:$I.R064,height:400,width:400,dialogClass:"likes yammer",open:function(g,h){if(!c.liked_by||c.liked_by.count==0){e.text($I.R065);return}e.empty();var f=c.web_url.replace(/\/messages\/.*/,"");$.each(c.liked_by.names,function(){$('<div class="like-user"/>').append($("<a/>").attr({href:f+"/users/"+this.permalink,target:"_blank"}).text(this.full_name)).appendTo(e)})},close:function(f,g){e.remove()},buttons:[{text:$I.R018,click:function(){$(this).dialog("close")}}]})}).appendTo(a.children(".time"));return a},renderMessage:function(i,d,h,e){var f=yammer.renderMessageCommon(i,d);if(i.group_id){if(!yammer.groups){yammer.groups={};$.each(accounts,function(){if(this.service=="yammer"&&this.type=="group"){yammer.groups[this.group_id]={id:this.group_id,name:this.group_name,url:this.group_url}}})}var j=yammer.groups[i.group_id];if(j){$(".user-name",f).after(" > ",$.A({className:"group-name",href:j.url,target:"_blank"},j.name))}}var b=null,c=i.refs&&i.refs.stats&&i.refs.stats.updates>1;if(c){var a=i.refs.stats.updates-1;if(a>2){$('<a class="comment-count" href="#"/>').text("Show "+(a-2)+" old comments").click(function(){var l=$(this);if(l.data("loading")){return}var n=$(".comment",f);function m(p){$.each(p,function(){if(this.id==i.thread_id){return}yammer.renderMessageCommon(this,d,f).prependTo(n)})}function k(){var p=a-$(".message",n).length;if(p>0){l.text("Show "+p+" old comments").data("loading",false)}else{l.remove()}}l.text("Loading...").data("loading",true);var o=$(".message",n).first().data("entry").id;$.ajax({url:"yammer/thread/"+d.account_name,data:{id:i.thread_id,older_than:o,limit:10},dataType:"json",success:function(p){if(p&&p.messages){m(p.messages)}else{showError($I.R058)}k()},error:function(){showError($I.R058);k()}})}).appendTo(f)}b=$("<div class='comment'/>").appendTo(f);var g=e.threaded_extended&&e.threaded_extended[i.thread_id];if(g){$.each(g,function(k,l){yammer.renderMessageCommon(l,d,f).prependTo(b)})}}else{b=$("<div class='comment'/>").appendTo(f)}createColumnInput(yammer,$("#"+d.key),d,b,{hideFirst:!c,replyTo:i.id});return f},getCreatedAt:function(a){try{return a.refs.stats.latest_reply_at}catch(b){return a.created_at}},onBeforeInsertMessage:function(b,c,a){$("#"+a.attr("id")).remove()},getNotificationInfo:function(d,f,e,c){function g(h){return{title:(h.sender.full_name||h.sender)+" in "+e.name,message:h.body.plain,icon:h.sender.mugshot_url}}var b=[];var a=f.threaded_extended[d.id];if(a){$.each(a,function(){if(this.created_at>c){b.unshift(g(this))}})}if(d.created_at>c){b.unshift(g(d))}return b},moreMessages:function(){var f=$(this),a=f.prev(".message-list"),d=a.parents(".column"),c=d.data("conf"),b=c.service+"/messages/"+c.account_name,e=a.children(".message:last"),g=e.data("entry").id;f.hide().next().show();$.getJSON(buildURL(b,{type:c.type,older_than:g}),function(h){renderMessages(yammer,h,a,c);f.show().next().hide()})}};var facebook={name:"Facebook",messageLimit:-1,canUploadImage:true,canPostInColumn:function(){return true},getColumnLink:function(a){var b=a.type;if(b=="me/home"){return"http://www.facebook.com/home.php?sk=lf"}if(b=="me/feed"){if(a.account_name.indexOf("page_")==0){return"http://www.facebook.com/profile.php?id="+a.account_name.split("_")[1]}return"http://www.facebook.com/profile.php?id="+a.account_name}if(b.indexOf("page/")==0){return"http://www.facebook.com/profile.php?id="+b.split("/")[1]}if(b.indexOf("app/")==0){return"http://apps.facebook.com/"+b.split("/")[1]}if(b.indexOf("list/")==0){return"http://www.facebook.com/?sk=fl_"+b.split("/")[1]}if(b.indexOf("group/")==0){return"http://www.facebook.com/groups/"+b.split("/")[1]}if(b.indexOf("search/")==0){return"http://www.facebook.com/search.php?type=eposts&q="+encodeURIComponent(b.split("/")[1])}return false},getIconClass:function(a){var b=a.type;if(b){if(b.indexOf("page/")==0){return"icon-facebook-page"}else{if(b.indexOf("group/")==0){return"icon-facebook-group"}else{if(b.indexOf("search/")==0){return"icon-facebook-search"}else{if(a.account_name.indexOf("page_")==0){return"icon-facebook-page"}}}}}else{if(a.postUrl){var c=accountsMap[a.postUrl];if(c.type){if(c.type=="group"){return"icon-facebook-group"}else{if(c.type=="page"){return"icon-facebook-page"}}}}}return"icon-"+a.service},getPostUrl:function(a){var b=a.account_name;if(a.currentAccount){b=a.currentAccount.account_name}if(a.account_name.indexOf("page_")==0&&a.type=="me/feed"){return"facebook/post/"+b+"/"+a.account_name.split("_")[1]}if(a.type.match(/^(page|group)\/([^\/]+)/)){page=RegExp.$2;return"facebook/post/"+b+"/"+page}return"facebook/post/"+b},getGroupImageUrl:function(a){if(a.type.match(/^page\/([^\/]+)$/)){return"https://graph.facebook.com/"+RegExp.$1+"/picture"}},getOtherAccount:function(a){if(a.type.indexOf("group/")==0){return[]}var b=[];$.each(accounts,function(){if(this.url.match("^facebook/post/[^/]+$")&&facebook.getPostUrl(a)!=this.url){b.push(this)}});return b},getDefaultColumnInfo:function(b,a){return[{name:"News Feed",account_label:a,account_name:b,type:"me/home",notification:false}]},renderLikeCount:function(b,c,a){var d=$.A({href:"#",className:"likes-count"},(b.likes?(b.likes.count||b.likes):0)+" likes").click(function(){var e=$.DIV().append($('<p class="loading"/>').text("Loading...")).appendTo(document.body);e.dialog({title:$I.R064,height:400,width:400,dialogClass:"likes",open:function(f,g){$.get("/facebook/api/"+c.account_name,{path:"/"+b.id+"/likes"},function(h){e.empty();if(!h.data||h.data.length==0){e.text($I.R065);return}$.each(h.data,function(){$('<div class="like-user"/>').append($("<a/>").attr({href:"http://www.facebook.com/profile.php?id="+this.id,target:"_blank"}).text(this.name).append($("<img/>").attr("src","https://graph.facebook.com/"+this.id+"/picture"))).appendTo(e)})})},close:function(f,g){e.remove()},buttons:[{text:$I.R018,click:function(){$(this).dialog("close")}}]})}).appendTo(a.children(".time"))},renderComment:function(a,c){var b=$.DIV({className:"message"},$.A({href:"http://www.facebook.com/profile.php?id="+a.from.id,className:"profile-image",target:"_blank"},$.IMG({src:"https://graph.facebook.com/"+a.from.id+"/picture"})),$.A({href:"http://www.facebook.com/profile.php?id="+a.from.id,className:"user-name",target:"_blank"},a.from.name||a.from.id),$.DIV({className:"time"},$.A({target:"_blank"},toLocalTime(a.display_time))),$.DIV({className:"message-text"}).html(a.display_text)).data("like",function(){$.ajax({type:"POST",url:"facebook/like/"+c.account_name+"?id="+a.id,success:function(){showNotice($I.R060);var d=(a.likes?(a.likes.count||a.likes):0);var e=b.find(".likes-count:first");if(!e.data("liked")){e.text((d+1)+" likes").data("liked",true)}},error:function(){showError($I.R061)}})});facebook.renderLikeCount(a,c,b);$(".message-text a",b).each(function(){var d=$(this);createAmazonLink(d.attr("href"),{type:"amazon",friend_name:a.from.name||a.from.id,friend_url:"http://www.facebook.com/profile.php?id="+a.from.id,body:a.display_text,success:function(e){d.attr("href",e)}})});return b},renderMessage:function(q,j,o){var h;if(j.type.indexOf("group/")==0){var b=q.id.split("_");h="http://www.facebook.com/groups/"+b[0]+"/?view=permalink&id="+b[1]}else{h=q.actions&&q.actions.length>0&&q.actions[0].link;if(!h){var b=q.id.split("_");h="http://www.facebook.com/"+b[0]+"/posts/"+b[1]}}var l=$.DIV({className:"message",id:j.key+"_"+q.id},$.A({href:"http://www.facebook.com/profile.php?id="+q.from.id,className:"profile-image",target:"_blank"},$.IMG({src:"https://graph.facebook.com/"+q.from.id+"/picture"})),$.A({href:"http://www.facebook.com/profile.php?id="+q.from.id,className:"user-name",target:"_blank"},q.from.name||q.from.id),$.DIV({className:"time"},$.A({href:h,target:"_blank"},toLocalTime(q.display_time))),$.DIV({className:"message-text"}).html(q.display_text)).data("comment",function(){openColumnInput(l,j,"",q.id)}).data("like",function(){$.ajax({type:"POST",url:"facebook/like/"+j.account_name+"?id="+q.id,success:function(){showNotice($I.R060);var i=(q.likes?(q.likes.count||q.likes):0);var r=l.find(".likes-count:first");if(!r.data("liked")){r.text((i+1)+" likes").data("liked",true)}},error:function(){showError($I.R061)}})}).data("entry",q);if((j.type=="me/feed"||j.type=="me/home")&&q.to&&q.to.data&&q.to.data.length>0){var p=q.to.data[0];if(p){var c="#";if(p.version){c="http://www.facebook.com/groups/"+p.id}else{c="http://www.facebook.com/profile.php?id="+p.id}$(".user-name",l).after($.A({href:c,target:"_blank",className:"user-fullname"}," > "+p.name))}}if(q.icon){$(".time",l).prepend($.IMG({src:q.icon}))}if(q.type!="status"){var h=$.A({href:q.link,target:"_blank"},q.name);var n=$.DIV({className:"attachment"},$.DIV({},h),$.DIV({},q.caption),$.DIV({},q.description)).appendTo(l);if(q.picture){var g=$.A({href:q.source||q.link,target:"_blank",className:"image-link"},$.IMG({src:q.picture}));n.prepend(g);createAmazonLink(q.source||q.link,{type:"amazon",friend_name:q.from.name||q.from.id,friend_url:"http://www.facebook.com/profile.php?id="+q.from.id,body:q.display_text,success:function(i){g.attr("href",i)}})}createAmazonLink(q.link,{type:"amazon",friend_name:q.from.name||q.from.id,friend_url:"http://www.facebook.com/profile.php?id="+q.from.id,body:q.display_text,success:function(i){h.attr("href",i)}})}var d=null;if(q.comments&&q.comments.count>0){var m=q.comments.data,e=m?m.length:0;var a=q.comments.count;var f=a-Math.min(2,e);if(f>0){$('<a class="comment-count" href="#"/>').text("Show "+f+" old comments").click(function(){var r=$(this);if(r.data("loading")){return}var u=l.data("comments");var t=$(".comment",l);function s(){var x=$(".message",t).length;var w=l.data("comments");for(var v=w.length-1-x;v>=0&&v>w.length-11-x;v--){facebook.renderComment(w[v],j).prependTo(t)}}function i(){var v=a-$(".message",t).length;if(v){r.text("Show "+v+" old comments").data("loading",false)}else{r.remove()}}if(!u||u.length<a){r.text("Loading...").data("loading",true);$.ajax({url:"facebook/thread/"+j.account_name,data:{id:q.id},dataType:"json",success:function(v){if(v&&v.comments&&v.comments.data){l.data("comments",v.comments.data);s()}else{showError($I.R058)}i()},error:function(){showError($I.R058);i()}})}else{s();i()}}).appendTo(l)}d=$("<div class='comment'/>").appendTo(l);if(e>0){for(var k=m.length-1;k>=0&&k>m.length-3;k--){facebook.renderComment(m[k],j).prependTo(d)}}l.data("comments",m)}else{d=$("<div class='comment'/>").appendTo(l)}createColumnInput(facebook,$("#"+j.key),j,d,{noAttach:true,hideFirst:!q.comments||q.comments.count==0,replyTo:q.id});facebook.renderLikeCount(q,j,l);$(".message-text a",l).each(function(){var i=$(this);createAmazonLink(i.attr("href"),{type:"amazon",friend_name:q.from.name||q.from.id,friend_url:"http://www.facebook.com/profile.php?id="+q.from.id,body:q.display_text,success:function(r){i.attr("href",r)}})});return l},checkAllMessages:true,onBeforeInsertMessage:function(b,c,a){$("#"+a.attr("id")).remove()},getNotificationInfo:function(c,e,d,b){function f(g){return{title:(g.from.name||g.from.id)+" in "+d.name,message:g.message,icon:"https://graph.facebook.com/"+g.from.id+"/picture"}}var a=[];if(c.comments&&c.comments.data){$.each(c.comments.data,function(){if(Date.parse(this.display_time)>b){a.push(f(this))}})}if(Date.parse(c.display_time)>b){a.unshift(f(c))}return a},getCreatedAt:function(a){if(a.comments&&a.comments.data){var b=a.comments.data;return Date.parse(b[b.length-1].display_time)}return Date.parse(a.display_time)},moreMessages:function(){var c=$(this),a=c.prev(".message-list"),b=a.parents(".column");conf=b.data("conf"),url=conf.service+"/messages/"+conf.account_name,lastMsg=a.children(".message:last"),until=lastMsg.data("entry")["updated_time"];c.hide().next().show();$.getJSON(buildURL(url,{type:conf.type,until:until}),function(d){renderMessages(facebook,d,a,conf);c.show().next().hide()})}};var linkedin={name:"LinkedIn",messageLimit:700,canPostInColumn:function(){return true},getColumnLink:function(a){if(a.href){return a.href}if(a.type=="my"){return"http://www.linkedin.com/updates?view=my"}return"https://www.linkedin.com/"},getIconClass:function(a){return"icon-"+a.service},getPostUrl:function(a){return"linkedin/post/"+a.account_name},getDefaultColumnInfo:function(b,a){return[{name:"All Updates",account_label:a,account_name:b,type:"updates",notification:false}]},renderComment:function(b,d){var a=b.person;var c=$.DIV({className:"message"},$.A({href:a.siteStandardProfileRequest.url,className:"profile-image",target:"_blank"},$.IMG({src:a.pictureUrl||"http://static01.linkedin.com/scds/common/u/img/icon/icon_no_photo_no_border_60x60.png"})),$.A({href:a.siteStandardProfileRequest.url,className:"user-name",target:"_blank"},a.firstName+" "+a.lastName),$.DIV({className:"time"},$.A({},formatDate(new Date(b.timestamp)))),$.DIV({className:"message-text"}).html(b.display_text||b.updateType)).data("id",b.id);return c},renderMessage:function(k,f,j){if(k.updateType!="SHAR"||!k.display_text){return false}var h=k.updateContent.person;var e=k.updateKey.split("-");var i=$.DIV({className:"message",id:k.updateKey},$.A({href:h.siteStandardProfileRequest.url,className:"profile-image",target:"_blank"},$.IMG({src:h.pictureUrl||"http://static01.linkedin.com/scds/common/u/img/icon/icon_no_photo_no_border_60x60.png"})),$.A({href:h.siteStandardProfileRequest.url,className:"user-name",target:"_blank"},h.firstName+" "+h.lastName),$.DIV({className:"time"},$.A({},formatDate(new Date(k.timestamp)))),$.DIV({className:"message-text"}).html(k.display_text||k.updateType)).data("entry",k);if(k.isCommentable){i.data("reply",function(){var l=f.account_name;openColumnInput(i,f,"",k.updateKey)})}if(k.isLikable){i.data("like",function(){$.ajax({type:"POST",url:"linkedin/like/"+f.account_name+"?id="+k.updateKey,success:function(){showNotice($I.R060);var l=k.likes?k.likes._total:0;var m=i.find(".likes-count:first");if(!m.data("liked")){m.text((l+1)+" likes").data("liked",true)}},error:function(){showError($I.R061)}})})}var g=10;function b(o){var p=$(".older-comment",i);if(p.data("loading")){return}var q=i.data("comments");var l=$(".comment",i);function n(t){var s=t-$(".message",l).length;if(s){p.text("Show "+s+" old comments").data("loading",false)}else{p.remove()}}p.text("Loading...").data("loading",true);var m=$(".message",l).length,r=0;if(o){r=o-m-g}$.ajax({url:"linkedin/comments/"+f.account_name,data:{id:k.updateKey,start:r>0?r:0,count:g},dataType:"json",success:function(u){try{if(u&&u.messages){var s=l.children(".message:first"),t=s.length>0;$.each(u.messages,function(){if(t&&this.id==s.data("id")){return false}var w=linkedin.renderComment(this,f);if(t){w.insertBefore(s)}else{w.appendTo(l)}})}else{showError($I.R058)}n(u._total)}catch(v){console.error(v)}},error:function(){showError($I.R058);n()}})}var c=$("<div class='comment'/>"),d=k.updateComments&&k.updateComments._total>0;if(d){var a=k.updateComments._total;if(a>g){$('<a class="older-comment" href="#"/>').text("Show "+(a-g)+" old comments").click(function(){b(a)}).appendTo(i);$.A({href:"#",className:"refresh-comment"},"Refresh").click(function(){$(".comment",i).empty();b()}).appendTo(i)}c.appendTo(i);$.each(k.updateComments.values,function(l,m){linkedin.renderComment(m,f).appendTo(c)})}else{c.appendTo(i)}createColumnInput(linkedin,$("#"+f.key),f,c,{noAttach:true,hideFirst:!d,replyTo:k.updateKey});$.A({className:"likes-count"},(k.likes?k.likes._total:0)+" likes").appendTo(i.children(".time"));return i},getNotificationInfo:function(b,d,c){var a=b.updateContent.person;return{title:(a.firstName+" "+a.lastName)+" in "+c.name,message:a.currentStatus,icon:a.pictureUrl}},getCreatedAt:function(a){if(a.updateComments&&a.updateComments.values){var b=a.updateComments.values;return b[b.length-1].timestamp}return a.timestamp},checkAllMessages:true,onBeforeInsertMessage:function(b,c,a){$("#"+a.attr("id")).remove()},moreMessages:function(){var f=$(this),a=f.prev(".message-list"),d=a.parents(".column"),c=d.data("conf"),b=c.service+"/messages/"+c.account_name,e=a.children(".message:last"),g=e.length>0?e.data("entry").timestamp:"";f.hide().next().show();$.getJSON(buildURL(b,{type:c.type,before:g}),function(h){renderMessages(linkedin,h,a,c);f.show().next().hide()})}};var chatter={name:"Chatter",messageLimit:-1,canPostInColumn:function(){return true},getColumnLink:function(a){return"https://na1.salesforce.com/_ui/core/chatter/ui/ChatterPage"},getIconClass:function(a){return"icon-"+a.service},getPostUrl:function(a){return"chatter/post/"+a.account_name},getDefaultColumnInfo:function(b,a){return[{name:"News Feed",account_label:a,account_name:b,type:"news",notification:false}]},renderComment:function(b,d){var h=chatter.getPostUrl(d);var g="https://na1.salesforce.com/_ui/core/userprofile/UserProfilePage?ChatterFeedItemId="+b.Id;var a=accountsMap?accountsMap[h].token:"";var i="";try{i=b.InsertedBy.Profile.CreatedBy.SmallPhotoUrl}catch(f){}var c=$.DIV({className:"message"},$.A({href:"https://na1.salesforce.com/"+b.CreatedBy.Id,className:"profile-image",target:"_blank"},$.IMG({src:i+"?oauth_token="+encodeURIComponent(a)})),$.A({href:"https://na1.salesforce.com/"+b.CreatedBy.Id,className:"user-name",target:"_blank"},b.CreatedBy.Name),$.DIV({className:"time"},$.A({href:g,target:"_blank"},toLocalTime(b.display_time))),$.DIV({className:"message-text"}).html(b.display_text));return c},renderMessage:function(n,g,m){var k=chatter.getPostUrl(g);var f="https://na1.salesforce.com/_ui/core/userprofile/UserProfilePage?ChatterFeedItemId="+n.Id;var d=accountsMap?accountsMap[k].token:"";var i="";try{i=n.InsertedBy.Profile.CreatedBy.SmallPhotoUrl}catch(l){}var h=$.DIV({className:"message",id:g.key+"_"+n.Id},$.A({href:"https://na1.salesforce.com/"+n.CreatedBy.Id,className:"profile-image",target:"_blank"},$.IMG({src:i+"?oauth_token="+encodeURIComponent(d)})),$.A({href:"https://na1.salesforce.com/"+n.CreatedBy.Id,className:"user-name",target:"_blank"},n.CreatedBy.Name),$.DIV({className:"time"},$.A({href:f,target:"_blank"},toLocalTime(n.display_time))),$.DIV({className:"message-text"}).html(n.display_text)).data("reply",function(){openColumnInput(h,g,"",n.Id,n.Body)}).data("entry",n);if(n){h.data("like",function(){$.ajax({type:"POST",url:"chatter/like/"+g.account_name+"?id="+n.Id,success:function(){showNotice($I.R060)},error:function(){showError($I.R061)}})})}if(n.ContentFileName||n.LinkUrl){var o=$('<div class="files"/>'),j=$('<div class="links"/>');if(n.Type=="ContentPost"){o.append($('<a target="_blank"/>').text(n.ContentFileName).attr("href","https://na1.salesforce.com/"+n.RelatedRecordId),$('<div class="description"/>').text(n.ContentDescription))}else{if(n.Type=="LinkPost"){$('<a target="_blank"/>').attr("href",n.LinkUrl).append(n.Title||n.LinkUrl).appendTo(j)}}h.append(o).append(j)}var b=$("<div class='comment'/>"),c=n.FeedComments&&n.FeedComments.totalSize>0;if(c){var a=n.CommentCount;if(a>2){$('<a class="comment-count" href="#"/>').text("Show "+(a-2)+" old comments").click(function(){var p=$(this);if(p.data("loading")){return}var s=h.data("comments");var r=$(".comment",h);function q(){var v=$(".message",r).length;var u=h.data("comments");for(var t=v;t<v+10&&t<u.length;t++){chatter.renderComment(u[t],g).prependTo(r)}}function e(){var t=a-$(".message",r).length;if(t){p.text("Show "+t+" old comments").data("loading",false)}else{p.remove()}}if(!s){p.text("Loading...").data("loading",true);$.ajax({url:"chatter/comments/"+g.account_name,data:{id:n.Id},dataType:"json",success:function(t){if(t){h.data("comments",t);q()}else{showError($I.R058)}e()},error:function(){showError($I.R058);e()}})}else{q();e()}}).appendTo(h)}b.appendTo(h);$.each(n.FeedComments.records,function(e,p){if(e>1){return false}chatter.renderComment(p,g).prependTo(b)})}else{b.appendTo(h)}createColumnInput(chatter,$("#"+g.key),g,b,{noAttach:true,hideFirst:!c,replyTo:n.Id});$.A({href:f,className:"likes-count",target:"_blank"},(n.FeedLikes?n.FeedLikes.totalSize:0)+" likes").appendTo(h.children(".time"));return h},checkAllMessages:true,onBeforeInsertMessage:function(b,c,a){$("#"+a.attr("id")).remove()},getNotificationInfo:function(a,c,b){return{title:a.user.name+" in "+b.name,message:a.body.text,icon:a.user.photo.smallPhotoUrl}},moreMessages:function(){var c=$(this),a=c.prev(".message-list"),b=a.parents(".column");conf=b.data("conf"),url=conf.service+"/messages/"+conf.account_name,lastMsg=a.children(".message:last"),until=lastMsg.data("entry")["LastModifiedDate"];c.hide().next().show();$.getJSON(buildURL(url,{type:conf.type,until:until}),function(d){renderMessages(chatter,d,a,conf);c.show().next().hide()})}};var cybozulive={name:$I.R077,messageLimit:-1,getDefaultColumnInfo:function(b,a){return[{name:$I.R059,account_label:b,account_name:b,type:"",notification:false}]},getIconClass:function(a){return"icon-"+a.service},renderMessage:function(d,e,c){var a=$.DIV({className:"message"},$.A({href:d.link,className:"user-name",target:"_blank"},d.title),$.DIV({className:"time"},$.A({href:d.link,target:"_blank"},toLocalTime(d.updated)),$.DIV({className:"author"},d.author)),$.DIV({className:"message-text short"}).append(d.summary)).data("entry",d);var b=d.id.split(",");if(b.length>3&&b[0]=="GROUP"&&b[2]=="BOARD"){a.data("reply",function(){var g=e.account_name;showPostMessageDialog("","cybozulive/post/"+g+"/"+b[1],d.id,d.summary)})}if(accounts&&b.length>1&&b[0]=="GROUP"){var f=cybozulive.getGroupName(b[1]);if(f){$(".user-name",a).after($.A({href:"https://cybozulive.com/"+b[1].replace(":","_")+"/top/top",target:"_blank"},f)).after(" in ")}}return a},getGroupName:function(b){if(!cybozulive.groups){var a={};$.each(accounts,function(){var c=this.url.split("/");a[c[c.length-1]]=this.name.split("/")[0]});cybozulive.groups=a}return cybozulive.groups[b]},getCreatedAt:function(a){return Date.parse(a.updated)},getNotificationInfo:function(a,c,b){return{title:a.author+" in "+b.name,message:a.summary,icon:STATIC_URL+"images/cybozulive.png"}},onAfterRenderMessages:function(c,a,b){$.each($(".message:not(:has(.more)) .message-text",a),function(){var d=$(this);if(d.height()==30){$.A({className:"more",href:"#"},$I.R050).click(function(){var e=$(this).prev();if(e.hasClass("short")){$(this).text($I.R051);e.removeClass("short")}else{$(this).text($I.R050);e.addClass("short")}}).insertAfter(d)}})}};var googleplus={getIconClass:function(a){return"icon-"+a.service},renderMessage:function(c,d,b){var a=$.DIV({className:"message"},$.A({href:c.actor.url,className:"profile-image",target:"_blank"},$.IMG({src:c.actor.image.url})),$.A({href:c.actor.url,className:"user-name",target:"_blank"},c.actor.displayName),$.DIV({className:"time"},$.A({href:c.url,target:"_blank"},toLocalTime(Date.parse(c.updated)))),$.DIV({className:"message-text"}).html(c.object.content)).data("entry",c);return a},getCreatedAt:function(a){return Date.parse(a.updated)},getNotificationInfo:function(a,c,b){return{title:b.name,message:a.object.content,icon:STATIC_URL+"images/googleplus.png"}}};var rss={getIconClass:function(a){return"icon-"+a.service},renderMessage:function(c,d,b){var a=$.DIV({className:"message"},$.A({href:c.link,className:"user-name",target:"_blank"},c.title),$.DIV({className:"time"},$.A({href:c.link,target:"_blank"},toLocalTime(c.updated)))).data("entry",c);return a},getCreatedAt:function(a){return Date.parse(a.updated)},getNotificationInfo:function(a,c,b){return{title:b.name,message:a.title,icon:STATIC_URL+"images/rss.png"}},onAfterRenderMessages:function(c,a,b){if(b.name!=c.title){$.post("column/rename",{id:b.key,name:c.title},function(){b.name=c.title});$("#"+b.key+" .column-name").text(c.title)}}};